<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Juego de Historia Universal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
      :root {
        color-scheme: light;
      }

      body {
        font-family: "Montserrat", sans-serif;
        overflow-x: hidden;
      }

      body.bloqueo-seguridad {
        user-select: none;
        -webkit-user-select: none;
      }

      body.bloqueo-seguridad input,
      body.bloqueo-seguridad textarea,
      body.bloqueo-seguridad [contenteditable="true"] {
        user-select: text;
        -webkit-user-select: text;
      }

      .overlay-inicio {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        background: rgba(15, 23, 42, 0.45);
        backdrop-filter: blur(10px);
        z-index: 50;
      }

      .overlay-inicio.oculto {
        display: none;
      }

      body.bloqueo-seguridad {
        user-select: none;
        -webkit-user-select: none;
      }

      body.bloqueo-seguridad input,
      body.bloqueo-seguridad textarea,
      body.bloqueo-seguridad [contenteditable="true"] {
        user-select: text;
        -webkit-user-select: text;
      }

      .overlay-inicio {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        background: rgba(15, 23, 42, 0.45);
        backdrop-filter: blur(10px);
        z-index: 50;
      }

      .overlay-inicio.oculto {
        display: none;
      }

      .anim-flotar {
        animation: flotar 3s ease-in-out infinite;
      }

      .anim-aparecer {
        animation: aparecer 0.5s ease;
      }

      .anim-correcto {
        animation: correcto 0.9s ease;
      }

      .anim-error {
        animation: error 0.5s ease;
      }

      .opcion-descartada {
        opacity: 0.4;
        filter: grayscale(0.4);
        pointer-events: none;
      }

      @keyframes flotar {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-4px);
        }
      }

      @keyframes aparecer {
        from {
          opacity: 0;
          transform: translateY(8px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes correcto {
        0% {
          transform: scale(1);
          box-shadow: 0 0 0 rgba(34, 197, 94, 0.4);
        }
        50% {
          transform: scale(1.02);
          box-shadow: 0 0 20px rgba(34, 197, 94, 0.55);
        }
        100% {
          transform: scale(1);
          box-shadow: 0 0 0 rgba(34, 197, 94, 0.25);
        }
      }

      @keyframes error {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-6px);
        }
        50% {
          transform: translateX(6px);
        }
        75% {
          transform: translateX(-4px);
        }
      }

      :root {
        --page-bg: linear-gradient(135deg, #f1f5f9 0%, #dbeafe 45%, #e0e7ff 100%);
        --panel-bg: rgba(255, 255, 255, 0.9);
        --card-bg: rgba(248, 250, 252, 0.85);
        --chip-bg: rgba(241, 245, 249, 0.9);
        --text-color: #0f172a;
        --muted-color: #475569;
        --accent: #6366f1;
        --accent-soft: rgba(99, 102, 241, 0.12);
        --panel-shadow: 0 24px 50px rgba(15, 23, 42, 0.08);
        --card-shadow: inset 0 0 0 rgba(0, 0, 0, 0.04);
      }

      body {
        background: var(--page-bg);
        color: var(--text-color);
        transition: background 0.6s ease, color 0.6s ease;
      }

      body[data-theme="principiante"] {
        --page-bg: linear-gradient(135deg, #fff7d6 0%, #fff1b8 55%, #ffe99d 100%);
        --panel-bg: rgba(255, 252, 238, 0.96);
        --card-bg: rgba(255, 248, 220, 0.95);
        --chip-bg: rgba(255, 244, 200, 0.95);
        --accent: #f59e0b;
        --accent-soft: rgba(245, 158, 11, 0.15);
      }

      body[data-theme="facil"] {
        --page-bg: linear-gradient(135deg, #e6f9f0 0%, #d0f4e0 55%, #c6f0d8 100%);
        --panel-bg: rgba(236, 252, 245, 0.95);
        --card-bg: rgba(220, 252, 231, 0.9);
        --chip-bg: rgba(209, 250, 229, 0.9);
        --accent: #22c55e;
        --accent-soft: rgba(34, 197, 94, 0.15);
      }

      body[data-theme="normal"] {
        --page-bg: linear-gradient(135deg, #f1f5f9 0%, #dbeafe 45%, #e0e7ff 100%);
        --panel-bg: rgba(255, 255, 255, 0.92);
        --card-bg: rgba(248, 250, 252, 0.88);
        --chip-bg: rgba(241, 245, 249, 0.92);
        --accent: #6366f1;
        --accent-soft: rgba(99, 102, 241, 0.12);
      }

      body[data-theme="dificil"] {
        --page-bg: linear-gradient(135deg, #ffe4e6 0%, #fecdd3 50%, #fda4af 100%);
        --panel-bg: rgba(255, 241, 242, 0.95);
        --card-bg: rgba(254, 226, 226, 0.9);
        --chip-bg: rgba(254, 215, 215, 0.9);
        --accent: #ef4444;
        --accent-soft: rgba(239, 68, 68, 0.18);
        --panel-shadow: 0 24px 60px rgba(239, 68, 68, 0.18);
      }

      body[data-theme="hardcore"] {
        --page-bg: linear-gradient(135deg, #000000 0%, #000000 55%, #050505 100%);
        --panel-bg: rgba(10, 10, 10, 0.94);
        --card-bg: rgba(22, 22, 22, 0.94);
        --chip-bg: rgba(0, 0, 0, 0.92);
        --text-color: #f8fafc;
        --muted-color: #e2e8f0;
        --accent: #000000;
        --accent-soft: rgba(0, 0, 0, 0.28);
        --panel-shadow: 0 24px 60px rgba(15, 23, 42, 0.45);
      }

      .theme-panel {
        background-color: var(--panel-bg) !important;
        box-shadow: var(--panel-shadow);
        transition: background-color 0.6s ease, box-shadow 0.6s ease;
      }

      .theme-card {
        background-color: var(--card-bg) !important;
        box-shadow: var(--card-shadow);
        transition: background-color 0.6s ease, box-shadow 0.6s ease;
      }

      .theme-chip {
        background-color: var(--chip-bg) !important;
        color: var(--muted-color) !important;
        transition: background-color 0.6s ease, color 0.6s ease;
      }

      body[data-theme] .text-slate-900,
      body[data-theme] .text-slate-800,
      body[data-theme] .text-slate-700,
      body[data-theme] .text-slate-600 {
        color: var(--text-color) !important;
      }

      body[data-theme] .text-slate-500,
      body[data-theme] .text-slate-400,
      body[data-theme] .leyenda-dificultad {
        color: var(--muted-color) !important;
      }

      body[data-theme] .theme-panel,
      body[data-theme] .theme-card {
        color: var(--text-color);
      }

      body[data-theme="hardcore"] .text-slate-800,
      body[data-theme="hardcore"] .text-slate-700,
      body[data-theme="hardcore"] .text-slate-600,
      body[data-theme="hardcore"] .text-slate-500,
      body[data-theme="hardcore"] .text-slate-400 {
        color: var(--text-color) !important;
      }

      body[data-theme="hardcore"] .text-indigo-600,
      body[data-theme="hardcore"] .text-indigo-500,
      body[data-theme="hardcore"] .text-emerald-600,
      body[data-theme="hardcore"] .text-amber-600 {
        color: var(--accent) !important;
      }

      body[data-theme="hardcore"] .text-slate-900 {
        color: #f1f5f9 !important;
      }

      body[data-theme="hardcore"] .text-slate-500,
      body[data-theme="hardcore"] .text-slate-400,
      body[data-theme="hardcore"] .leyenda-dificultad {
        color: var(--muted-color) !important;
      }

      body[data-theme="hardcore"] .bg-white,
      body[data-theme="hardcore"] .bg-white\/80,
      body[data-theme="hardcore"] .bg-white\/90 {
        background-color: rgba(30, 41, 59, 0.92) !important;
        color: var(--text-color) !important;
      }

      body[data-theme="hardcore"] .bg-slate-50\/80,
      body[data-theme="hardcore"] .bg-slate-50,
      body[data-theme="hardcore"] .bg-slate-100 {
        background-color: rgba(30, 41, 59, 0.92) !important;
        color: var(--text-color) !important;
      }

      body[data-theme="hardcore"] input,
      body[data-theme="hardcore"] textarea,
      body[data-theme="hardcore"] select {
        color: var(--text-color) !important;
      }

      body[data-theme="hardcore"] input::placeholder {
        color: rgba(226, 232, 240, 0.75) !important;
      }

      body[data-theme="hardcore"] button {
        color: var(--text-color) !important;
      }

      body[data-theme="hardcore"] .bg-emerald-100,
      body[data-theme="hardcore"] .bg-rose-100 {
        background-color: rgba(30, 41, 59, 0.9) !important;
        color: var(--text-color) !important;
      }

      body[data-theme="hardcore"] .border-slate-200,
      body[data-theme="hardcore"] .border-indigo-200,
      body[data-theme="hardcore"] .border-amber-200,
      body[data-theme="hardcore"] .border-emerald-200,
      body[data-theme="hardcore"] .border-sky-200 {
        border-color: rgba(148, 163, 184, 0.35) !important;
      }

      .dificultad-slider {
        position: relative;
        width: min(260px, 100%);
        padding: 1.6rem 0 0.9rem;
      }

      .dificultad-slider input[type="range"] {
        position: relative;
        width: 100%;
        height: 16px;
        background: transparent;
        appearance: none;
        cursor: pointer;
        z-index: 3;
      }

      .dificultad-slider input[type="range"]::-webkit-slider-thumb {
        appearance: none;
        width: 26px;
        height: 26px;
        border-radius: 50%;
        background: var(--accent);
        border: 4px solid #fff;
        box-shadow: 0 8px 14px rgba(15, 23, 42, 0.16);
        transition: background-color 0.4s ease, transform 0.2s ease;
      }

      .dificultad-slider input[type="range"]::-moz-range-thumb {
        width: 26px;
        height: 26px;
        border-radius: 50%;
        background: var(--accent);
        border: 4px solid #fff;
        box-shadow: 0 8px 14px rgba(15, 23, 42, 0.16);
        transition: background-color 0.4s ease, transform 0.2s ease;
      }

      .dificultad-slider input[type="range"]:active::-webkit-slider-thumb,
      .dificultad-slider input[type="range"]:active::-moz-range-thumb {
        transform: scale(1.05);
      }

      .dificultad-track {
        position: absolute;
        left: 0;
        right: 0;
        top: 50%;
        height: 10px;
        transform: translateY(-50%);
        border-radius: 999px;
        background: rgba(226, 232, 240, 0.9);
        overflow: hidden;
      }

      .dificultad-fill {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        width: 50%;
        background: linear-gradient(90deg, var(--accent) 0%, rgba(255, 255, 255, 0.5) 110%);
        transition: width 0.4s ease, background 0.4s ease;
      }

      .dificultad-point {
        position: absolute;
        top: 50%;
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 2px 6px rgba(15, 23, 42, 0.2);
        transform: translate(-50%, -50%);
        z-index: 2;
      }

      .dificultad-burbuja {
        position: absolute;
        top: -0.1rem;
        transform: translate(-50%, -6px);
        background: var(--accent);
        color: #fff;
        padding: 0.35rem 0.7rem;
        border-radius: 0.85rem;
        font-size: 0.7rem;
        font-weight: 700;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        transition: left 0.4s ease, background 0.4s ease, color 0.4s ease;
        white-space: nowrap;
        z-index: 2;
      }

      .dificultad-burbuja::after {
        content: "";
        position: absolute;
        left: 50%;
        bottom: -6px;
        transform: translateX(-50%);
        border-width: 6px 6px 0 6px;
        border-style: solid;
        border-color: var(--accent) transparent transparent transparent;
      }

      .leyenda-dificultad {
        color: var(--muted-color);
      }

      body[data-theme="principiante"] .dificultad-burbuja {
        color: #1f2937;
      }


      .tarjeta-transicion {
        transition: transform 0.35s ease, box-shadow 0.35s ease, opacity 0.35s ease;
      }

      .tarjeta-transicion:hover {
        transform: translateY(-3px);
      }

      .anim-suave {
        animation: aparecer 0.5s ease;
      }

      .inicio-slider {
        position: relative;
        padding-top: 3.4rem;
        animation: aparecer 0.45s ease;
      }

      .inicio-dificultad-badge {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        min-width: 128px;
        text-align: center;
        padding: 0.6rem 1rem;
        border-radius: 1rem;
        background: var(--badge-color, #111827);
        color: #f8fafc;
        font-size: 0.8rem;
        font-weight: 800;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        transition: background-color 0.4s ease, color 0.4s ease;
      }

      .inicio-dificultad-badge::after {
        content: "";
        position: absolute;
        left: 50%;
        bottom: -8px;
        transform: translateX(-50%);
        border-width: 8px 8px 0 8px;
        border-style: solid;
        border-color: var(--badge-color, #111827) transparent transparent transparent;
        transition: border-color 0.4s ease;
      }

      .inicio-dificultad-track {
        position: relative;
        height: 62px;
        display: flex;
        align-items: center;
        padding: 0 22px;
      }

      .inicio-dificultad-base {
        position: absolute;
        inset: 50% 22px auto 22px;
        transform: translateY(-50%);
        height: 16px;
        border-radius: 999px;
        background: #e5e7eb;
        overflow: hidden;
      }

      .inicio-dificultad-fill {
        height: 100%;
        width: 50%;
        border-radius: 999px;
        background: #6366f1;
        transition: width 0.4s ease, background-color 0.4s ease;
      }

      .inicio-dificultad-point {
        position: absolute;
        top: 50%;
        width: 12px;
        height: 12px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 2px 8px rgba(15, 23, 42, 0.2);
        transform: translate(-50%, -50%);
        z-index: 2;
      }

      #inicioDificultad {
        position: relative;
        width: calc(100% - 44px);
        margin-left: 22px;
        appearance: none;
        background: transparent;
        z-index: 3;
      }

      #inicioDificultad::-webkit-slider-thumb {
        appearance: none;
        width: 54px;
        height: 54px;
        border-radius: 50%;
        background: var(--slider-color, #4a90e2);
        border: 10px solid #f8fafc;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.22);
        transition: transform 0.25s ease, background-color 0.4s ease;
      }

      #inicioDificultad::-moz-range-thumb {
        width: 54px;
        height: 54px;
        border-radius: 50%;
        background: var(--slider-color, #4a90e2);
        border: 10px solid #f8fafc;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.22);
        transition: transform 0.25s ease, background-color 0.4s ease;
      }

      #inicioDificultad:active::-webkit-slider-thumb,
      #inicioDificultad:active::-moz-range-thumb {
        transform: scale(1.08);
      }


      body:not([data-theme="hardcore"]) #overlayNuevaPartida .theme-panel {
        background: rgba(255, 255, 255, 0.95) !important;
        color: #0f172a !important;
      }

      body:not([data-theme="hardcore"]) #overlayNuevaPartida input,
      body:not([data-theme="hardcore"]) #overlayNuevaPartida select {
        color: #334155 !important;
        background-color: rgba(255, 255, 255, 0.95) !important;
        border-color: rgba(148, 163, 184, 0.45) !important;
      }

      body:not([data-theme="hardcore"]) #overlayNuevaPartida input::placeholder {
        color: rgba(100, 116, 139, 0.95) !important;
      }

      body[data-theme="hardcore"] #overlayNuevaPartida .theme-panel {
        background: rgba(9, 14, 25, 0.97) !important;
        color: #f8fafc !important;
      }

      body[data-theme="hardcore"] #overlayNuevaPartida input,
      body[data-theme="hardcore"] #overlayNuevaPartida select {
        color: #f8fafc !important;
        background-color: rgba(30, 41, 59, 0.9) !important;
        border-color: rgba(148, 163, 184, 0.35) !important;
      }

      body[data-theme="hardcore"] #overlayNuevaPartida #inicioCategoria {
        color: #334155 !important;
        background: linear-gradient(90deg, #eef2ff 0%, #e0f2fe 100%) !important;
        border-color: rgba(148, 163, 184, 0.45) !important;
      }

      body[data-theme="hardcore"] #overlayNuevaPartida #inicioCategoria option {
        color: #334155 !important;
        background: #ffffff !important;
      }

      body[data-theme="hardcore"] #overlayNuevaPartida input::placeholder {
        color: rgba(226, 232, 240, 0.7) !important;
      }

      .dificultad-resumen {
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(248, 250, 252, 0.95);
        border-radius: 1rem;
        padding: 0.8rem;
        min-height: 138px;
        transition: opacity 0.3s ease, transform 0.3s ease, border-color 0.3s ease;
      }


      body[data-theme="hardcore"] .dificultad-resumen {
        border-color: rgba(148, 163, 184, 0.32);
        background: rgba(15, 23, 42, 0.7);
      }

      .dificultad-resumen.animando {
        opacity: 0.4;
        transform: translateY(5px);
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-slate-100 via-blue-50 to-indigo-100 text-slate-900 transition-colors duration-300"
    data-theme="normal"
  >
    <div class="mx-auto flex min-h-screen max-w-6xl flex-col gap-8 px-4 py-8">
      <header class="theme-panel animar-entrada tarjeta-transicion rounded-3xl bg-white/90 p-8 shadow-2xl backdrop-blur transition-colors duration-300">
        <div class="flex flex-col gap-6 lg:flex-row lg:items-center lg:justify-between">
          <div>
            <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-500">
              Juego educativo
            </p>
            <h1 class="mt-2 text-4xl font-bold text-slate-900 md:text-5xl">Historia Universal</h1>
            <p class="mt-3 max-w-xl text-slate-500">
              Vive los períodos históricos con retos dinámicos, feedback inmediato y progreso guardado.
            </p>
          </div>
          <div class="flex flex-col items-start gap-3 sm:flex-row sm:items-center">
            <div
              class="anim-flotar rounded-2xl bg-gradient-to-r from-indigo-500 via-blue-500 to-sky-400 px-6 py-4 text-sm font-semibold text-white shadow-lg"
            >
              Daniel Rivera · José Osorio · Nelson Carrillo
            </div>
          </div>
        </div>
      </header>

      <section class="grid gap-6 lg:grid-cols-[260px,1fr]">
        <aside class="theme-panel animar-entrada tarjeta-transicion rounded-3xl bg-white/90 p-6 shadow-xl transition-colors duration-300">
          <h2 class="text-lg font-semibold text-slate-800">Menú Principal</h2>
          <div class="mt-4 flex flex-col gap-3">
            <p class="text-xs text-slate-500">Partida activa</p>
            <button
              class="rounded-2xl bg-gradient-to-r from-indigo-500 to-blue-500 px-4 py-3 text-sm font-semibold text-white shadow-md transition hover:-translate-y-0.5 hover:from-indigo-400 hover:to-blue-400"
              id="botonTerminarPartida"
              data-action="terminar"
            >
              Terminar partida
            </button>
                        <div class="theme-card rounded-2xl bg-slate-50/80 p-3 shadow-inner" id="panelNombreGuardado">
              <label class="text-xs font-semibold text-slate-500" for="nombreGuardado">Nombre de la partida</label>
              <input
                class="mt-2 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-xs text-slate-700 focus:border-indigo-300 focus:outline-none"
                id="nombreGuardado"
                placeholder="Ej: Reto Antigüedad"
                type="text"
              />
            </div>
            <button
              class="rounded-2xl bg-white/80 px-4 py-3 text-sm font-semibold text-slate-700 shadow-sm transition hover:-translate-y-0.5"
              data-action="guardar"
            >
              Guardar partida
            </button>
            <button
              class="rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm font-semibold text-slate-600 shadow-sm transition hover:-translate-y-0.5 hover:border-indigo-200"
              data-action="puntajes"
            >
              Puntajes
            </button>
          </div>
          <p class="mt-6 text-xs font-medium text-slate-400" id="estadoGuardado">
            No hay partida guardada.
          </p>
          <div class="mt-4">
            <p class="text-xs font-semibold text-slate-500">Partidas guardadas (máximo)</p>
            <div class="mt-2 flex flex-col gap-2" id="listaGuardados"></div>
          </div>
        </aside>

        <main class="theme-panel animar-entrada tarjeta-transicion rounded-3xl bg-white/90 p-6 shadow-xl transition-colors duration-300">
          <div class="flex flex-wrap items-start justify-between gap-4">
            <div>
              <p
                class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-400"
                id="etiquetaCategoria"
              >
                Selecciona una categoría
              </p>
              <h2 class="mt-1 text-2xl font-semibold text-slate-800" id="etiquetaNivel">Reto actual</h2>
            </div>
            <div class="flex gap-3">
              <div
                class="theme-chip rounded-2xl bg-slate-100 px-4 py-2 text-xs font-semibold text-slate-500 shadow-sm"
              >
                Vidas <span class="ml-1 text-slate-700" id="vidas">3</span>
              </div>
              <div
                class="theme-chip rounded-2xl bg-slate-100 px-4 py-2 text-xs font-semibold text-slate-500 shadow-sm"
              >
                Puntaje <span class="ml-1 text-slate-700" id="puntaje">0</span>
              </div>
              <div
                class="theme-chip rounded-2xl bg-slate-100 px-4 py-2 text-xs font-semibold text-slate-500 shadow-sm"
              >
                Tiempo <span class="ml-1 text-slate-700" id="tiempoRestante">30</span>s
              </div>
            </div>
          </div>

          <div
            class="theme-card anim-aparecer mt-6 rounded-3xl bg-slate-50/80 p-6 shadow-inner transition-colors duration-300"
            id="tarjetaPregunta"
          >
            <p class="text-base font-medium text-slate-700" id="textoPregunta">
              Selecciona una opción para comenzar el reto histórico.
            </p>
            <div class="mt-4 grid gap-3 sm:grid-cols-2" id="opciones"></div>
          </div>

          <div
            class="theme-card anim-aparecer mt-4 flex items-center gap-3 rounded-3xl bg-slate-50/80 p-4 shadow-inner transition-colors duration-300"
            id="retroalimentacion"
          >
            <span class="text-lg">✨</span>
            <p class="text-sm text-slate-600" id="textoFeedback">Elige un reto para iniciar.</p>
          </div>
              <div class="mt-4 flex flex-wrap gap-2" id="panelComodines">
                <button
                  class="rounded-2xl border border-indigo-200 bg-white px-4 py-2 text-xs font-semibold text-indigo-600 shadow-sm transition hover:-translate-y-0.5 disabled:opacity-50"
                  id="comodinPista"
                >
                  Comodín: Pista
                </button>
                <button
                  class="rounded-2xl border border-amber-200 bg-white px-4 py-2 text-xs font-semibold text-amber-600 shadow-sm transition hover:-translate-y-0.5 disabled:opacity-50"
                  id="comodinSaltar"
                >
                  Comodín: Saltar
                </button>
                <button
                  class="rounded-2xl border border-emerald-200 bg-white px-4 py-2 text-xs font-semibold text-emerald-600 shadow-sm transition hover:-translate-y-0.5 disabled:opacity-50"
                  id="comodinInvestigar"
                >
                  Comodín: Investigar 10s
                </button>
                <button
                  class="rounded-2xl border border-sky-200 bg-white px-4 py-2 text-xs font-semibold text-sky-600 shadow-sm transition hover:-translate-y-0.5 disabled:opacity-50"
                  id="comodinEliminar"
                >
                  Comodín: Eliminar 2
                </button>
              </div>
            </main>
      </section>

      <section class="hidden" id="seccionCategorias" aria-hidden="true">
        <div class="mt-4 grid gap-4 md:grid-cols-3" id="categorias"></div>
      </section>

      <section class="theme-panel animar-entrada tarjeta-transicion rounded-3xl bg-white/90 p-6 shadow-xl transition-colors duration-300">
        <h2 class="text-lg font-semibold text-slate-800">Integrantes</h2>
        <div class="mt-4 grid gap-3 md:grid-cols-3">
          <div class="theme-card rounded-2xl bg-slate-50 p-4 shadow-inner">
            <p class="font-semibold text-slate-700">Daniel Rivera</p>
            <p class="text-xs text-slate-400">C.I: 31.048.830</p>
          </div>
          <div class="theme-card rounded-2xl bg-slate-50 p-4 shadow-inner">
            <p class="font-semibold text-slate-700">José Osorio</p>
            <p class="text-xs text-slate-400">C.I: 30.973.057</p>
          </div>
          <div class="theme-card rounded-2xl bg-slate-50 p-4 shadow-inner">
            <p class="font-semibold text-slate-700">Nelson Carrillo</p>
            <p class="text-xs text-slate-400">C.I: 31.611.962</p>
          </div>
        </div>
      </section>
    </div>

    <div class="overlay-inicio" id="overlayInicio">
      <div class="theme-panel w-full max-w-xl rounded-3xl bg-white/95 p-6 shadow-2xl">
        <h2 class="text-2xl font-bold text-slate-900">Menú de inicio</h2>
        <p class="mt-2 text-sm text-slate-500">Inicia una nueva partida o abre el gestor de partidas.</p>
        <div class="mt-5 grid gap-3 sm:grid-cols-2">
          <button class="rounded-2xl bg-gradient-to-r from-indigo-500 to-blue-500 px-4 py-3 text-sm font-semibold text-white" id="botonAbrirNuevaPartida">Nueva partida</button>
          <button class="rounded-2xl bg-white px-4 py-3 text-sm font-semibold text-slate-700 shadow" id="botonAbrirGestor">Gestor de partidas</button>
        </div>
      </div>
    </div>

    <div class="overlay-inicio oculto" id="overlayNuevaPartida">
      <div class="theme-panel w-full max-w-xl rounded-3xl bg-white/95 p-6 shadow-2xl">
        <h3 class="text-xl font-bold text-slate-900">Configurar nueva partida</h3>
        <div class="mt-4 space-y-3">
          <input class="w-full rounded-xl border border-slate-200 px-3 py-2 text-sm" id="inicioNombrePartida" placeholder="Nombre de partida" type="text"/>
          <div class="rounded-2xl border border-slate-200 bg-gradient-to-r from-white to-slate-50/90 p-3 tarjeta-transicion anim-suave shadow-sm">
            <label class="mb-2 inline-flex items-center gap-2 text-xs font-bold uppercase tracking-[0.2em] text-slate-600" for="inicioCategoria">
              <span class="inline-block h-2 w-2 rounded-full bg-indigo-500"></span>
              Selector de categoría
            </label>
            <select class="w-full rounded-xl border border-indigo-100 bg-gradient-to-r from-indigo-50 to-blue-50 px-3 py-3 text-sm font-semibold text-slate-700 shadow-sm transition-all duration-300 focus:border-indigo-300 focus:outline-none focus:ring-2 focus:ring-indigo-200" id="inicioCategoria"></select>
            <p class="mt-2 text-[11px] text-slate-500">Elige la categoría histórica para comenzar la partida.</p>
          </div>
          <label class="text-xs font-bold uppercase tracking-[0.2em] text-slate-600">Dificultad</label>
          <div class="inicio-slider tarjeta-transicion">
            <p class="inicio-dificultad-badge" id="inicioDificultadNombre">Normal</p>
            <div class="inicio-dificultad-track">
              <div class="inicio-dificultad-base">
                <div class="inicio-dificultad-fill" id="inicioDificultadFill"></div>
              </div>
              <span class="inicio-dificultad-point" style="left: 0%"></span>
              <span class="inicio-dificultad-point" style="left: 25%"></span>
              <span class="inicio-dificultad-point" style="left: 50%"></span>
              <span class="inicio-dificultad-point" style="left: 75%"></span>
              <span class="inicio-dificultad-point" style="left: 100%"></span>
              <input id="inicioDificultad" max="4" min="0" step="1" type="range" value="2" class="w-full"/>
            </div>
          </div>
          <div class="dificultad-resumen" id="inicioDificultadResumen"></div>
        </div>
        <div class="mt-4 flex gap-3">
          <button class="rounded-2xl bg-indigo-600 px-4 py-3 text-sm font-semibold text-white" id="botonIniciarPartida">Iniciar partida</button>
          <button class="rounded-2xl bg-white px-4 py-3 text-sm font-semibold text-slate-700 shadow" id="botonVolverInicio">Volver</button>
        </div>
      </div>
    </div>

    <div class="overlay-inicio oculto" id="overlayGestorPartidas">
      <div class="theme-panel w-full max-w-3xl rounded-3xl bg-white/95 p-6 shadow-2xl">
        <h3 class="text-xl font-bold text-slate-900">Gestor de partidas</h3>
        <div class="mt-4 max-h-[55vh] overflow-y-auto space-y-3" id="listaGuardadosGestor"></div>
        <div class="mt-4">
          <button class="rounded-2xl bg-white px-4 py-3 text-sm font-semibold text-slate-700 shadow" id="botonCerrarGestor">Volver al inicio</button>
        </div>
      </div>
    </div>


    <script>
      /*
        ============================================================
        Juego de Historia Universal (versión web)
        ------------------------------------------------------------
        - Todo el código vive en este archivo para facilitar el fork.
        - Variables y funciones están en español para ser legibles.
        ============================================================
      */

      const CLAVE_GUARDADO = "historia-save";
      const CLAVE_LISTA_GUARDADOS = "historia-guardadas";
      const NIVELES_DIFICULTAD = ["principiante", "facil", "normal", "dificil", "hardcore"];

      const estado = {
        categorias: [
          {
            nombre: "Antigüedad",
            descripcion: "Civilizaciones iniciales, ciencia y cultura.",
            preguntas: [
              {
                enunciado: "¿Cuál de estas civilizaciones se desarrolló junto al río Nilo?",
                opciones: ["Mesopotamia", "Egipto", "China", "Grecia"],
                respuesta: "Egipto",
                retroalimentacion: "Egipto creció gracias a las crecidas del Nilo.",
              },
              {
                enunciado: "¿Qué invento permitió registrar leyes y comercio?",
                opciones: ["La escritura", "La brújula", "La pólvora", "La rueda"],
                respuesta: "La escritura",
                retroalimentacion: "La escritura organizó la vida urbana.",
              },
              {
                enunciado: "¿En qué región surgió Mesopotamia?",
                opciones: [
                  "Entre los ríos Tigris y Éufrates",
                  "En los Andes",
                  "En el Sahara",
                  "En la península Ibérica",
                ],
                respuesta: "Entre los ríos Tigris y Éufrates",
                retroalimentacion: "Mesopotamia significa 'entre ríos'.",
              },
              {
                enunciado: "¿Qué pueblo destacó por su comercio marítimo?",
                opciones: ["Fenicios", "Mayas", "Aztecas", "Incas"],
                respuesta: "Fenicios",
                retroalimentacion: "Los fenicios dominaron rutas comerciales.",
              },
              {
                enunciado: "¿Qué sistema político se consolidó en Atenas?",
                opciones: ["Democracia", "Feudalismo", "Teocracia", "Monarquía absoluta"],
                respuesta: "Democracia",
                retroalimentacion: "Atenas impulsó la democracia directa.",
              },
              {
                enunciado: "¿Qué imperio construyó la Vía Apia?",
                opciones: ["Imperio Romano", "Imperio Persa", "Imperio Chino", "Imperio Otomano"],
                respuesta: "Imperio Romano",
                retroalimentacion: "Roma expandió su red de calzadas.",
              },
              {
                enunciado: "¿Cuál fue un aporte científico de los griegos?",
                opciones: ["Geometría", "Imprenta", "Electricidad", "Motor de combustión"],
                respuesta: "Geometría",
                retroalimentacion: "Euclides destacó en geometría.",
              },
              {
                enunciado: "¿Qué río fue clave para la civilización del Indo?",
                opciones: ["Indo", "Amazonas", "Danubio", "Nilo"],
                respuesta: "Indo",
                retroalimentacion: "El Indo dio origen a esa civilización.",
              },
              {
                enunciado: "¿Qué imperio inició la Gran Muralla?",
                opciones: ["China", "Roma", "Persia", "Egipto"],
                respuesta: "China",
                retroalimentacion: "La Gran Muralla fue obra china.",
              },
              {
                enunciado: "¿Cuál fue la capital del Imperio Bizantino?",
                opciones: ["Constantinopla", "Roma", "Atenas", "Alejandría"],
                respuesta: "Constantinopla",
                retroalimentacion: "Constantinopla fue su centro político.",
              },
              {
                enunciado: "¿Qué estructura monumental eran tumbas reales en Egipto?",
                opciones: ["Pirámides", "Zigurats", "Anfiteatros", "Catedrales"],
                respuesta: "Pirámides",
                retroalimentacion: "Las pirámides guardaban a los faraones.",
              },
              {
                enunciado: "¿Qué código legal es uno de los más antiguos?",
                opciones: ["Código de Hammurabi", "Código Napoleónico", "Leyes de Indias", "Fuero Juzgo"],
                respuesta: "Código de Hammurabi",
                retroalimentacion: "Hammurabi dejó un código famoso.",
              },
              {
                enunciado: "¿Qué invento chino revolucionó la navegación?",
                opciones: ["Brújula", "Telescopio", "Imprenta", "Motor a vapor"],
                respuesta: "Brújula",
                retroalimentacion: "La brújula facilitó los viajes marítimos.",
              },
              {
                enunciado: "¿Qué civilización construyó Machu Picchu?",
                opciones: ["Inca", "Maya", "Azteca", "Olmeca"],
                respuesta: "Inca",
                retroalimentacion: "Machu Picchu es un legado inca.",
              },
              {
                enunciado: "¿Qué río permitió el desarrollo de la India antigua?",
                opciones: ["Ganges", "Nilo", "Tigris", "Éufrates"],
                respuesta: "Ganges",
                retroalimentacion: "El Ganges es sagrado y vital en India.",
              },
              {
                enunciado: "¿Qué ciudad fue enterrada por el Vesubio?",
                opciones: ["Pompeya", "Roma", "Cartago", "Atenas"],
                respuesta: "Pompeya",
                retroalimentacion: "Pompeya quedó sepultada en el año 79.",
              },
              {
                enunciado: "¿Cuál era el lenguaje de la antigua Roma?",
                opciones: ["Latín", "Griego", "Hebreo", "Árabe"],
                respuesta: "Latín",
                retroalimentacion: "El latín fue la lengua del Imperio Romano.",
              },
              {
                enunciado: "¿Qué dios era principal en la mitología egipcia?",
                opciones: ["Ra", "Zeus", "Odín", "Anubis"],
                respuesta: "Ra",
                retroalimentacion: "Ra era el dios del sol.",
              },
              {
                enunciado: "¿Qué civilización levantó Stonehenge?",
                opciones: ["Britanos antiguos", "Mayas", "Persas", "Chinos"],
                respuesta: "Britanos antiguos",
                retroalimentacion: "Stonehenge es una construcción megalítica.",
              },
              {
                enunciado: "¿Cuál fue uno de los primeros alfabetos?",
                opciones: ["Fenicio", "Latino", "Cirílico", "Hebreo"],
                respuesta: "Fenicio",
                retroalimentacion: "El alfabeto fenicio inspiró otros alfabetos.",
              },
            ],
            preguntasDificiles: [
              {
                enunciado: "¿Qué ciudad mesopotámica destacó por el zigurat de Ur?",
                opciones: ["Ur", "Nínive", "Biblos", "Tiro"],
                respuesta: "Ur",
                retroalimentacion: "Ur fue un centro urbano sumerio con un gran zigurat.",
              },
              {
                enunciado: "¿Quién impulsó la Biblioteca de Alejandría en la era ptolemaica?",
                opciones: ["Ptolomeo I", "Cleopatra VII", "Alejandro Magno", "Julio César"],
                respuesta: "Ptolomeo I",
                retroalimentacion: "Ptolomeo I promovió la biblioteca como centro de saber.",
              },
              {
                enunciado: "¿Qué guerra debilitó a Atenas y favoreció a Esparta?",
                opciones: ["Guerra del Peloponeso", "Guerras Médicas", "Guerra Lámica", "Guerra Social"],
                respuesta: "Guerra del Peloponeso",
                retroalimentacion: "La Guerra del Peloponeso marcó el declive ateniense.",
              },
              {
                enunciado: "¿Qué pueblo se asocia con los filisteos en el Levante?",
                opciones: ["Pueblos del Mar", "Partos", "Escitas", "Sajones"],
                respuesta: "Pueblos del Mar",
                retroalimentacion: "Los filisteos son vinculados a los Pueblos del Mar.",
              },
              {
                enunciado: "¿Qué capital hitita fue excavada en la actual Turquía?",
                opciones: ["Hattusa", "Susa", "Persepolis", "Tebas"],
                respuesta: "Hattusa",
                retroalimentacion: "Hattusa fue la capital del Imperio hitita.",
              },
              {
                enunciado: "¿Qué faraón intentó imponer el culto a Atón?",
                opciones: ["Akenatón", "Ramsés II", "Tutankamón", "Keops"],
                respuesta: "Akenatón",
                retroalimentacion: "Akenatón promovió el monoteísmo de Atón.",
              },
              {
                enunciado: "¿Qué reino africano controló rutas del oro en el Sahel antiguo?",
                opciones: ["Ghana", "Cártago", "Kush", "Aksum"],
                respuesta: "Ghana",
                retroalimentacion: "Ghana medieval temprano controló rutas del oro.",
              },
              {
                enunciado: "¿Qué reforma militar permitió a Roma reclutar a ciudadanos sin tierras?",
                opciones: ["Reformas de Mario", "Reformas de Sila", "Reformas de Augusto", "Reformas de Trajano"],
                respuesta: "Reformas de Mario",
                retroalimentacion: "Mario profesionalizó el ejército romano.",
              },
              {
                enunciado: "¿Qué general cartaginés cruzó los Alpes con elefantes?",
                opciones: ["Aníbal", "Escipión", "Asdrúbal", "Hamilcar"],
                respuesta: "Aníbal",
                retroalimentacion: "Aníbal llevó su ejército a Italia por los Alpes.",
              },
              {
                enunciado: "¿Qué dinastía china consolidó la Ruta de la Seda?",
                opciones: ["Han", "Qin", "Tang", "Song"],
                respuesta: "Han",
                retroalimentacion: "La dinastía Han impulsó rutas comerciales.",
              },
              {
                enunciado: "¿Qué ciudad griega fue destruida tras la batalla de Leuctra?",
                opciones: ["Esparta", "Corinto", "Argos", "Mileto"],
                respuesta: "Esparta",
                retroalimentacion: "Leuctra debilitó decisivamente a Esparta.",
              },
              {
                enunciado: "¿Qué filósofo fundó el Liceo en Atenas?",
                opciones: ["Aristóteles", "Sócrates", "Platón", "Epicuro"],
                respuesta: "Aristóteles",
                retroalimentacion: "Aristóteles estableció el Liceo.",
              },
              {
                enunciado: "¿Qué imperio usó la escritura cuneiforme en tablillas de arcilla?",
                opciones: ["Sumerio", "Azteca", "Inca", "Maya"],
                respuesta: "Sumerio",
                retroalimentacion: "Los sumerios desarrollaron la cuneiforme.",
              },
              {
                enunciado: "¿Qué batalla naval consolidó el dominio de Roma en el Mediterráneo occidental?",
                opciones: ["Batalla de las Égadas", "Batalla de Salamina", "Batalla de Ecnomo", "Batalla de Accio"],
                respuesta: "Batalla de las Égadas",
                retroalimentacion: "Las Égadas cerraron la Primera Guerra Púnica.",
              },
              {
                enunciado: "¿Qué reino helenístico tuvo como capital Pérgamo?",
                opciones: ["Reino de Pérgamo", "Seleúcidas", "Ptolomeos", "Antigónidas"],
                respuesta: "Reino de Pérgamo",
                retroalimentacion: "Pérgamo fue un centro cultural helenístico.",
              },
              {
                enunciado: "¿Qué civilización andina desarrolló la ciudad de Chan Chan?",
                opciones: ["Chimú", "Nazca", "Moche", "Tiwanaku"],
                respuesta: "Chimú",
                retroalimentacion: "Chan Chan fue capital de los Chimú.",
              },
              {
                enunciado: "¿Qué reforma religiosa fue clave en el Imperio Persa aqueménida?",
                opciones: ["Zoroastrismo", "Budismo", "Hinduismo", "Cristianismo"],
                respuesta: "Zoroastrismo",
                retroalimentacion: "El zoroastrismo influyó en la política persa.",
              },
              {
                enunciado: "¿Qué ciudad fenicia fundó la colonia de Cartago?",
                opciones: ["Tiro", "Sidón", "Biblos", "Ugarit"],
                respuesta: "Tiro",
                retroalimentacion: "Tiro fue clave en la expansión fenicia.",
              },
              {
                enunciado: "¿Qué conflicto enfrentó a Roma con Mitrídates VI?",
                opciones: ["Guerras Mitridáticas", "Guerras Samnitas", "Guerras Galas", "Guerras Serviles"],
                respuesta: "Guerras Mitridáticas",
                retroalimentacion: "Mitrídates desafió la expansión romana.",
              },
              {
                enunciado: "¿Qué estructura mesopotámica servía como templo escalonado?",
                opciones: ["Zigurat", "Ágora", "Acueducto", "Coliseo"],
                respuesta: "Zigurat",
                retroalimentacion: "Los zigurats eran templos escalonados.",
              },
            ],
          },
          {
            nombre: "Edad Media",
            descripcion: "Feudos, religiones y expansión cultural.",
            preguntas: [
              {
                enunciado: "¿Qué sistema social dominó Europa medieval?",
                opciones: ["Feudalismo", "Capitalismo", "Socialismo", "Democracia"],
                respuesta: "Feudalismo",
                retroalimentacion: "El feudalismo estructuró la sociedad medieval.",
              },
              {
                enunciado: "¿Qué ruta comercial conectaba Europa con Asia?",
                opciones: ["Ruta de la Seda", "Ruta del Ámbar", "Ruta del Inca", "Ruta del Oro"],
                respuesta: "Ruta de la Seda",
                retroalimentacion: "La Ruta de la Seda unía Oriente y Occidente.",
              },
              {
                enunciado: "¿Qué ciudad fue capital del Imperio Carolingio?",
                opciones: ["Aquisgrán", "París", "Roma", "Londres"],
                respuesta: "Aquisgrán",
                retroalimentacion: "Carlomagno gobernó desde Aquisgrán.",
              },
              {
                enunciado: "¿Qué institución religiosa tuvo gran poder en la Edad Media?",
                opciones: ["Iglesia", "Senado", "Parlamento", "Gremios"],
                respuesta: "Iglesia",
                retroalimentacion: "La Iglesia fue central en la vida medieval.",
              },
              {
                enunciado: "¿Cómo se llamaban las comunidades de artesanos?",
                opciones: ["Gremios", "Tribus", "Senados", "Ligas"],
                respuesta: "Gremios",
                retroalimentacion: "Los gremios organizaban oficios urbanos.",
              },
              {
                enunciado: "¿Qué conflicto enfrentó a cristianos y musulmanes en Tierra Santa?",
                opciones: ["Cruzadas", "Reconquista", "Guerra de los Cien Años", "Guerra Fría"],
                respuesta: "Cruzadas",
                retroalimentacion: "Las cruzadas buscaron controlar Jerusalén.",
              },
              {
                enunciado: "¿Qué imperio se expandió desde Constantinopla?",
                opciones: ["Bizantino", "Mongol", "Inca", "Azteca"],
                respuesta: "Bizantino",
                retroalimentacion: "El Imperio Bizantino continuó a Roma.",
              },
              {
                enunciado: "¿Qué civilización construyó la Alhambra?",
                opciones: ["Musulmanes", "Visigodos", "Francos", "Vikingos"],
                respuesta: "Musulmanes",
                retroalimentacion: "La Alhambra es una joya andalusí.",
              },
              {
                enunciado: "¿Qué pandemia asoló Europa en el siglo XIV?",
                opciones: ["Peste Negra", "Gripe Española", "Viruela", "Cólera"],
                respuesta: "Peste Negra",
                retroalimentacion: "La Peste Negra redujo la población europea.",
              },
              {
                enunciado: "¿Quién fue un líder vikingo famoso?",
                opciones: ["Erik el Rojo", "Julio César", "Napoleón", "Alejandro"],
                respuesta: "Erik el Rojo",
                retroalimentacion: "Erik el Rojo exploró Groenlandia.",
              },
              {
                enunciado: "¿Qué ciudad italiana fue un centro comercial medieval?",
                opciones: ["Venecia", "Madrid", "Berlín", "Lisboa"],
                respuesta: "Venecia",
                retroalimentacion: "Venecia dominó rutas marítimas.",
              },
              {
                enunciado: "¿Qué imperio se originó en la península arábiga?",
                opciones: ["Islámico", "Inca", "Romano", "Chino"],
                respuesta: "Islámico",
                retroalimentacion: "El Islam se expandió rápidamente.",
              },
              {
                enunciado: "¿Qué rey inglés firmó la Carta Magna?",
                opciones: ["Juan Sin Tierra", "Enrique VIII", "Ricardo III", "Eduardo I"],
                respuesta: "Juan Sin Tierra",
                retroalimentacion: "La Carta Magna limitó al rey.",
              },
              {
                enunciado: "¿Qué estilo arquitectónico se usó en catedrales medievales?",
                opciones: ["Gótico", "Barroco", "Neoclásico", "Moderno"],
                respuesta: "Gótico",
                retroalimentacion: "El gótico destaca por sus vitrales.",
              },
              {
                enunciado: "¿Qué territorio recuperaron los reinos cristianos en España?",
                opciones: ["Al-Ándalus", "Borgoña", "Sicilia", "Baviera"],
                respuesta: "Al-Ándalus",
                retroalimentacion: "La Reconquista buscó recuperar Al-Ándalus.",
              },
              {
                enunciado: "¿Qué documento definió leyes en el reino visigodo?",
                opciones: ["Fuero Juzgo", "Código Napoleónico", "Doce Tablas", "Código Hammurabi"],
                respuesta: "Fuero Juzgo",
                retroalimentacion: "El Fuero Juzgo fue un código visigodo.",
              },
              {
                enunciado: "¿Qué orden militar protegía peregrinos?",
                opciones: ["Templarios", "Espartanos", "Samuráis", "Legionarios"],
                respuesta: "Templarios",
                retroalimentacion: "Los templarios fueron una orden militar.",
              },
              {
                enunciado: "¿Qué ciudad fue arrasada por los mongoles en 1258?",
                opciones: ["Bagdad", "Roma", "París", "El Cairo"],
                respuesta: "Bagdad",
                retroalimentacion: "Bagdad cayó ante los mongoles.",
              },
              {
                enunciado: "¿Qué país vivió la Guerra de los Cien Años?",
                opciones: ["Francia e Inglaterra", "España y Portugal", "Rusia y Suecia", "Alemania y Italia"],
                respuesta: "Francia e Inglaterra",
                retroalimentacion: "La guerra duró más de un siglo.",
              },
              {
                enunciado: "¿Qué universidad medieval es una de las más antiguas?",
                opciones: ["Bolonia", "Harvard", "Oxford", "Salamanca"],
                respuesta: "Bolonia",
                retroalimentacion: "Bolonia se fundó en el siglo XI.",
              },
            ],
            preguntasDificiles: [
              {
                enunciado: "¿Qué acuerdo de 843 dividió el Imperio Carolingio?",
                opciones: ["Tratado de Verdún", "Paz de Augsburgo", "Concordato de Worms", "Tratado de Tordesillas"],
                respuesta: "Tratado de Verdún",
                retroalimentacion: "Verdún fragmentó el poder carolingio.",
              },
              {
                enunciado: "¿Qué dinastía china expulsó a los mongoles en el siglo XIV?",
                opciones: ["Ming", "Han", "Song", "Yuan"],
                respuesta: "Ming",
                retroalimentacion: "La dinastía Ming reemplazó a los Yuan.",
              },
              {
                enunciado: "¿Qué centro intelectual islámico destacó en Bagdad?",
                opciones: ["Casa de la Sabiduría", "Universidad de París", "Biblioteca de Nínive", "Academia de Atenas"],
                respuesta: "Casa de la Sabiduría",
                retroalimentacion: "La Casa de la Sabiduría impulsó la traducción científica.",
              },
              {
                enunciado: "¿Qué orden militar defendía caminos de peregrinación a Tierra Santa?",
                opciones: ["Templarios", "Teutónicos", "Hospitalarios", "Jesuitas"],
                respuesta: "Templarios",
                retroalimentacion: "Los templarios protegían peregrinos y rutas.",
              },
              {
                enunciado: "¿Qué batalla frenó el avance islámico en Francia en 732?",
                opciones: ["Poitiers", "Hastings", "Bouvines", "Manzikert"],
                respuesta: "Poitiers",
                retroalimentacion: "Poitiers o Tours marcó un freno al avance.",
              },
              {
                enunciado: "¿Qué pueblo estableció el Kaganato en Europa oriental?",
                opciones: ["Jázaros", "Vikingos", "Francos", "Lombardos"],
                respuesta: "Jázaros",
                retroalimentacion: "Los jázaros controlaron rutas del Caspio.",
              },
              {
                enunciado: "¿Qué documento limitó el poder del Papa sobre los obispos?",
                opciones: ["Concordato de Worms", "Edicto de Milán", "Bula Inter Caetera", "Capitulare de Villis"],
                respuesta: "Concordato de Worms",
                retroalimentacion: "Worms resolvió la Querella de las Investiduras.",
              },
              {
                enunciado: "¿Qué ciudad fue clave para el comercio de la Liga Hanseática?",
                opciones: ["Lübeck", "Sevilla", "Florencia", "Marsella"],
                respuesta: "Lübeck",
                retroalimentacion: "Lübeck fue el corazón hanseático.",
              },
              {
                enunciado: "¿Qué imperio derrotó a Bizancio en Manzikert (1071)?",
                opciones: ["Selyúcida", "Mongol", "Otomano", "Búlgaro"],
                respuesta: "Selyúcida",
                retroalimentacion: "Manzikert abrió Anatolia a los turcos selyúcidas.",
              },
              {
                enunciado: "¿Qué concilio medieval definió la transubstanciación?",
                opciones: ["Letrán IV", "Trento", "Nicea", "Éfeso"],
                respuesta: "Letrán IV",
                retroalimentacion: "Letrán IV estableció dogmas clave.",
              },
              {
                enunciado: "¿Qué ciudad fue saqueada en la Cuarta Cruzada?",
                opciones: ["Constantinopla", "Jerusalén", "Antioquía", "Acre"],
                respuesta: "Constantinopla",
                retroalimentacion: "La Cuarta Cruzada tomó Constantinopla.",
              },
              {
                enunciado: "¿Qué monarca impulsó la centralización en Inglaterra tras la conquista normanda?",
                opciones: ["Guillermo el Conquistador", "Ricardo Corazón de León", "Enrique II", "Eduardo III"],
                respuesta: "Guillermo el Conquistador",
                retroalimentacion: "Guillermo reorganizó el reino inglés.",
              },
              {
                enunciado: "¿Qué ruta unía Escandinavia con Bizancio a través del Dniéper?",
                opciones: ["Ruta de los varegos", "Ruta del Ámbar", "Ruta del Inca", "Ruta de la Sal"],
                respuesta: "Ruta de los varegos",
                retroalimentacion: "Los varegos conectaban el Báltico con Bizancio.",
              },
              {
                enunciado: "¿Qué reino africano cristiano resistió en Nubia?",
                opciones: ["Makuria", "Benín", "Kongo", "Mali"],
                respuesta: "Makuria",
                retroalimentacion: "Makuria fue un reino cristiano en Nubia.",
              },
              {
                enunciado: "¿Qué técnica agrícola medieval permitió rotar cultivos en tres campos?",
                opciones: ["Rotación trienal", "Enfiteusis", "Terraceado", "Roza"],
                respuesta: "Rotación trienal",
                retroalimentacion: "La rotación trienal elevó la productividad.",
              },
              {
                enunciado: "¿Qué ciudad fue símbolo del comercio islámico en África del Norte?",
                opciones: ["Fez", "Tombuctú", "Gao", "Zanzíbar"],
                respuesta: "Fez",
                retroalimentacion: "Fez fue un núcleo urbano y religioso.",
              },
              {
                enunciado: "¿Qué documento recopiló leyes en Castilla en el siglo XIII?",
                opciones: ["Siete Partidas", "Fuero Juzgo", "Lex Salica", "Assizes"],
                respuesta: "Siete Partidas",
                retroalimentacion: "Las Siete Partidas fueron clave en Castilla.",
              },
              {
                enunciado: "¿Qué orden mendicante surgió en el siglo XIII?",
                opciones: ["Franciscanos", "Benedictinos", "Cartujos", "Cluniacenses"],
                respuesta: "Franciscanos",
                retroalimentacion: "Los franciscanos promovieron la pobreza.",
              },
              {
                enunciado: "¿Qué ciudad italiana fue sede de la banca medieval de los Medici?",
                opciones: ["Florencia", "Génova", "Pisa", "Milán"],
                respuesta: "Florencia",
                retroalimentacion: "Florencia destacó por sus banqueros.",
              },
              {
                enunciado: "¿Qué reino peninsular culminó la Reconquista en 1492?",
                opciones: ["Castilla y Aragón", "Portugal", "Navarra", "Granada"],
                respuesta: "Castilla y Aragón",
                retroalimentacion: "La unión de Castilla y Aragón tomó Granada.",
              },
            ],
          },
          {
            nombre: "Renacimiento",
            descripcion: "Arte, ciencia y exploraciones globales.",
            preguntas: [
              {
                enunciado: "¿Qué artista pintó la Mona Lisa?",
                opciones: ["Leonardo da Vinci", "Miguel Ángel", "Rafael", "Donatello"],
                respuesta: "Leonardo da Vinci",
                retroalimentacion: "Da Vinci creó la Mona Lisa.",
              },
              {
                enunciado: "¿Qué invento permitió difundir libros masivamente?",
                opciones: ["Imprenta", "Telescopio", "Brújula", "Motor"],
                respuesta: "Imprenta",
                retroalimentacion: "Gutenberg impulsó la imprenta.",
              },
              {
                enunciado: "¿Qué ciudad italiana fue cuna del Renacimiento?",
                opciones: ["Florencia", "Roma", "Venecia", "Milán"],
                respuesta: "Florencia",
                retroalimentacion: "Florencia fue epicentro cultural.",
              },
              {
                enunciado: "¿Quién esculpió el David?",
                opciones: ["Miguel Ángel", "Leonardo", "Botticelli", "Bernini"],
                respuesta: "Miguel Ángel",
                retroalimentacion: "El David es una obra de Miguel Ángel.",
              },
              {
                enunciado: "¿Qué monarquía financió el viaje de Colón?",
                opciones: ["España", "Portugal", "Francia", "Inglaterra"],
                respuesta: "España",
                retroalimentacion: "Los Reyes Católicos apoyaron a Colón.",
              },
              {
                enunciado: "¿Qué océano cruzó Colón en 1492?",
                opciones: ["Atlántico", "Índico", "Pacífico", "Ártico"],
                respuesta: "Atlántico",
                retroalimentacion: "Colón cruzó el Atlántico.",
              },
              {
                enunciado: "¿Qué científico defendió el heliocentrismo?",
                opciones: ["Copérnico", "Ptolomeo", "Galeno", "Aristóteles"],
                respuesta: "Copérnico",
                retroalimentacion: "Copérnico propuso el Sol al centro.",
              },
              {
                enunciado: "¿Qué navegante dio la primera vuelta al mundo?",
                opciones: ["Magallanes-Elcano", "Marco Polo", "Vespucci", "Da Gama"],
                respuesta: "Magallanes-Elcano",
                retroalimentacion: "La expedición completó la circunnavegación.",
              },
              {
                enunciado: "¿Qué obra escribió Maquiavelo?",
                opciones: ["El Príncipe", "Utopía", "La República", "Hamlet"],
                respuesta: "El Príncipe",
                retroalimentacion: "Maquiavelo analizó el poder político.",
              },
              {
                enunciado: "¿Qué explorador llegó a la India rodeando África?",
                opciones: ["Vasco da Gama", "Colón", "Caboto", "Pizarro"],
                respuesta: "Vasco da Gama",
                retroalimentacion: "Da Gama abrió la ruta a Asia.",
              },
              {
                enunciado: "¿Qué civilización conquistó Hernán Cortés?",
                opciones: ["Azteca", "Inca", "Maya", "Olmeca"],
                respuesta: "Azteca",
                retroalimentacion: "Cortés conquistó Tenochtitlán.",
              },
              {
                enunciado: "¿Quién conquistó el Imperio Inca?",
                opciones: ["Francisco Pizarro", "Colón", "Balboa", "Almagro"],
                respuesta: "Francisco Pizarro",
                retroalimentacion: "Pizarro capturó a Atahualpa.",
              },
              {
                enunciado: "¿Qué pintor creó la Capilla Sixtina?",
                opciones: ["Miguel Ángel", "Rafael", "Botticelli", "Tiziano"],
                respuesta: "Miguel Ángel",
                retroalimentacion: "Miguel Ángel pintó la bóveda.",
              },
              {
                enunciado: "¿Qué movimiento religioso inició Lutero?",
                opciones: ["Reforma", "Contrarreforma", "Humanismo", "Ilustración"],
                respuesta: "Reforma",
                retroalimentacion: "Lutero inició la Reforma protestante.",
              },
              {
                enunciado: "¿Qué obra literaria escribió Dante?",
                opciones: ["Divina Comedia", "Quijote", "Fausto", "Beowulf"],
                respuesta: "Divina Comedia",
                retroalimentacion: "Dante escribió la Divina Comedia.",
              },
              {
                enunciado: "¿Qué artista pintó El nacimiento de Venus?",
                opciones: ["Botticelli", "Caravaggio", "Da Vinci", "Giotto"],
                respuesta: "Botticelli",
                retroalimentacion: "Botticelli pintó Venus.",
              },
              {
                enunciado: "¿Qué monarca impulsó la Contrarreforma?",
                opciones: ["Carlos V", "Luis XIV", "Isabel I", "Pedro I"],
                respuesta: "Carlos V",
                retroalimentacion: "Carlos V apoyó la Contrarreforma.",
              },
              {
                enunciado: "¿Qué instrumento mejoró Galileo?",
                opciones: ["Telescopio", "Microscopio", "Brújula", "Reloj"],
                respuesta: "Telescopio",
                retroalimentacion: "Galileo perfeccionó el telescopio.",
              },
              {
                enunciado: "¿Qué país lideró la exploración del Atlántico?",
                opciones: ["Portugal", "Rusia", "Suecia", "Polonia"],
                respuesta: "Portugal",
                retroalimentacion: "Portugal exploró rutas atlánticas.",
              },
              {
                enunciado: "¿Qué obra pintó Rafael en el Vaticano?",
                opciones: ["La Escuela de Atenas", "Guernica", "Las Meninas", "La Última Cena"],
                respuesta: "La Escuela de Atenas",
                retroalimentacion: "Rafael pintó La Escuela de Atenas.",
              },
            ],
            preguntasDificiles: [
              {
                enunciado: "¿Qué mecenas impulsó el Renacimiento florentino desde la banca?",
                opciones: ["Cosme de Médici", "Lorenzo de Borbón", "Carlos V", "Enrique VIII"],
                respuesta: "Cosme de Médici",
                retroalimentacion: "Los Médici financiaron arte y ciencia.",
              },
              {
                enunciado: "¿Qué tratado político escribió Maquiavelo para los Médici?",
                opciones: ["El Príncipe", "Utopía", "La Ciudad del Sol", "Leviatán"],
                respuesta: "El Príncipe",
                retroalimentacion: "Maquiavelo dedicó su obra a los Médici.",
              },
              {
                enunciado: "¿Qué navegante portugués llegó a Brasil en 1500?",
                opciones: ["Pedro Álvares Cabral", "Bartolomé Díaz", "Vasco da Gama", "Magallanes"],
                respuesta: "Pedro Álvares Cabral",
                retroalimentacion: "Cabral arribó a Brasil por accidente.",
              },
              {
                enunciado: "¿Qué obra científica de Vesalio renovó la anatomía?",
                opciones: ["De humani corporis fabrica", "De revolutionibus", "Novum Organum", "Almagesto"],
                respuesta: "De humani corporis fabrica",
                retroalimentacion: "Vesalio revolucionó la anatomía moderna.",
              },
              {
                enunciado: "¿Qué pintor renacentista es famoso por el sfumato?",
                opciones: ["Leonardo da Vinci", "Tiziano", "El Bosco", "Tintoretto"],
                respuesta: "Leonardo da Vinci",
                retroalimentacion: "El sfumato es un sello de Leonardo.",
              },
              {
                enunciado: "¿Qué ciudad fue epicentro editorial del humanismo alemán?",
                opciones: ["Maguncia", "Roma", "Venecia", "Sevilla"],
                respuesta: "Maguncia",
                retroalimentacion: "Maguncia fue clave para la imprenta.",
              },
              {
                enunciado: "¿Qué reforma religiosa dividió Europa en el siglo XVI?",
                opciones: ["Reforma protestante", "Gran Cisma", "Contrarreforma", "Ilustración"],
                respuesta: "Reforma protestante",
                retroalimentacion: "La Reforma protestante alteró el mapa religioso.",
              },
              {
                enunciado: "¿Qué artista diseñó la cúpula de Santa María del Fiore?",
                opciones: ["Brunelleschi", "Bernini", "Bramante", "Palladio"],
                respuesta: "Brunelleschi",
                retroalimentacion: "Brunelleschi diseñó la cúpula florentina.",
              },
              {
                enunciado: "¿Qué navegante cartografió el Estrecho de Magallanes?",
                opciones: ["Magallanes", "Drake", "Cook", "Hudson"],
                respuesta: "Magallanes",
                retroalimentacion: "La expedición de Magallanes abrió ese paso.",
              },
              {
                enunciado: "¿Qué obra literaria inauguró la novela moderna en España?",
                opciones: ["Don Quijote", "La Celestina", "Lazarillo", "Amadís"],
                respuesta: "Don Quijote",
                retroalimentacion: "El Quijote es considerada la primera novela moderna.",
              },
              {
                enunciado: "¿Qué ciudad fue sede del Concilio que respondió a la Reforma?",
                opciones: ["Trento", "Lyon", "Toledo", "Milán"],
                respuesta: "Trento",
                retroalimentacion: "El Concilio de Trento impulsó la Contrarreforma.",
              },
              {
                enunciado: "¿Qué astrónomo propuso las órbitas elípticas?",
                opciones: ["Kepler", "Galileo", "Tycho Brahe", "Newton"],
                respuesta: "Kepler",
                retroalimentacion: "Kepler formuló las órbitas elípticas.",
              },
              {
                enunciado: "¿Qué ciudad fue famosa por su imprenta de Aldo Manuzio?",
                opciones: ["Venecia", "Lisboa", "Génova", "Nápoles"],
                respuesta: "Venecia",
                retroalimentacion: "Venecia fue un polo editorial renacentista.",
              },
              {
                enunciado: "¿Qué expedición completó la primera circunnavegación?",
                opciones: ["Magallanes-Elcano", "Da Gama", "Caboto", "Colón"],
                respuesta: "Magallanes-Elcano",
                retroalimentacion: "La expedición regresó a España en 1522.",
              },
              {
                enunciado: "¿Qué pintor renacentista se asocia con la escuela veneciana?",
                opciones: ["Tiziano", "Giotto", "Masaccio", "Fra Angelico"],
                respuesta: "Tiziano",
                retroalimentacion: "Tiziano fue clave en la pintura veneciana.",
              },
              {
                enunciado: "¿Qué obra arquitectónica es de Andrea Palladio?",
                opciones: ["Villa Rotonda", "Notre Dame", "El Escorial", "Coliseo"],
                respuesta: "Villa Rotonda",
                retroalimentacion: "Palladio diseñó la Villa Rotonda.",
              },
              {
                enunciado: "¿Qué navegante inglés circunnavegó el globo tras 1577?",
                opciones: ["Francis Drake", "Walter Raleigh", "Frobisher", "Cook"],
                respuesta: "Francis Drake",
                retroalimentacion: "Drake completó la circunnavegación inglesa.",
              },
              {
                enunciado: "¿Qué obra filosófica de Erasmo criticó la sociedad?",
                opciones: ["Elogio de la locura", "Utopía", "Leviatán", "Oración por la paz"],
                respuesta: "Elogio de la locura",
                retroalimentacion: "Erasmo satirizó los vicios de su época.",
              },
              {
                enunciado: "¿Qué ciudad fue capital del Imperio español durante el Siglo de Oro?",
                opciones: ["Madrid", "Sevilla", "Toledo", "Valencia"],
                respuesta: "Madrid",
                retroalimentacion: "Madrid se consolidó como capital imperial.",
              },
              {
                enunciado: "¿Qué humanista defendió la educación femenina en el Renacimiento?",
                opciones: ["Christine de Pizan", "Isabel I", "Teresa de Ávila", "Juana de Arco"],
                respuesta: "Christine de Pizan",
                retroalimentacion: "Christine de Pizan escribió sobre educación y igualdad.",
              },
            ],
          },
          {
            nombre: "Revoluciones",
            descripcion: "Cambios políticos, industriales y sociales.",
            preguntas: [
              {
                enunciado: "¿Qué documento proclamó los derechos del hombre en 1789?",
                opciones: ["Declaración de los Derechos del Hombre", "Carta Magna", "Constitución de Cádiz", "Bill of Rights"],
                respuesta: "Declaración de los Derechos del Hombre",
                retroalimentacion: "La declaración fue clave en la Revolución Francesa.",
              },
              {
                enunciado: "¿Qué país lideró la Revolución Industrial?",
                opciones: ["Inglaterra", "España", "Portugal", "Rusia"],
                respuesta: "Inglaterra",
                retroalimentacion: "Inglaterra fue pionera industrial.",
              },
              {
                enunciado: "¿Qué máquina impulsó la industria textil?",
                opciones: ["Spinning Jenny", "Telégrafo", "Imprenta", "Locomotora"],
                respuesta: "Spinning Jenny",
                retroalimentacion: "La Spinning Jenny aumentó la producción.",
              },
              {
                enunciado: "¿Qué líder encabezó la independencia de Haití?",
                opciones: ["Toussaint Louverture", "Bolívar", "San Martín", "Sucre"],
                respuesta: "Toussaint Louverture",
                retroalimentacion: "Louverture lideró la revolución haitiana.",
              },
              {
                enunciado: "¿Qué evento inició la Revolución Francesa?",
                opciones: ["Toma de la Bastilla", "Congreso de Viena", "Paz de Westfalia", "Tratado de Versalles"],
                respuesta: "Toma de la Bastilla",
                retroalimentacion: "La toma de la Bastilla fue simbólica.",
              },
              {
                enunciado: "¿Quién lideró la independencia de EE.UU.?",
                opciones: ["George Washington", "Abraham Lincoln", "Thomas Jefferson", "Benjamin Franklin"],
                respuesta: "George Washington",
                retroalimentacion: "Washington comandó al ejército continental.",
              },
              {
                enunciado: "¿Qué imperio fue derrotado en la Revolución Americana?",
                opciones: ["Británico", "Español", "Francés", "Portugués"],
                respuesta: "Británico",
                retroalimentacion: "Las colonias vencieron al Imperio Británico.",
              },
              {
                enunciado: "¿Qué líder consolidó el poder tras la Revolución Francesa?",
                opciones: ["Napoleón", "Robespierre", "Luis XVI", "Marat"],
                respuesta: "Napoleón",
                retroalimentacion: "Napoleón se proclamó emperador.",
              },
              {
                enunciado: "¿Qué revolución ocurrió en 1917 en Rusia?",
                opciones: ["Revolución Bolchevique", "Revolución Gloriosa", "Revolución Industrial", "Revolución Cultural"],
                respuesta: "Revolución Bolchevique",
                retroalimentacion: "Los bolcheviques tomaron el poder.",
              },
              {
                enunciado: "¿Qué sistema económico defendía Karl Marx?",
                opciones: ["Socialismo", "Mercantilismo", "Liberalismo", "Feudalismo"],
                respuesta: "Socialismo",
                retroalimentacion: "Marx propuso el socialismo científico.",
              },
              {
                enunciado: "¿Qué fue la Comuna de París?",
                opciones: ["Gobierno obrero", "Tratado", "Reforma agraria", "Movimiento religioso"],
                respuesta: "Gobierno obrero",
                retroalimentacion: "La Comuna fue un gobierno popular.",
              },
              {
                enunciado: "¿Qué revolución inició en 1910 en México?",
                opciones: ["Revolución Mexicana", "Revolución Cubana", "Revolución Gloriosa", "Revolución Verde"],
                respuesta: "Revolución Mexicana",
                retroalimentacion: "La Revolución Mexicana cambió el país.",
              },
              {
                enunciado: "¿Qué líder mexicano impulsó la reforma agraria?",
                opciones: ["Emiliano Zapata", "Porfirio Díaz", "Villa", "Madero"],
                respuesta: "Emiliano Zapata",
                retroalimentacion: "Zapata defendió 'Tierra y libertad'.",
              },
              {
                enunciado: "¿Qué evento marcó el inicio de la independencia de Venezuela?",
                opciones: ["19 de abril de 1810", "5 de julio de 1811", "Batalla de Carabobo", "Congreso de Angostura"],
                respuesta: "19 de abril de 1810",
                retroalimentacion: "Fue el inicio del proceso independentista.",
              },
              {
                enunciado: "¿Qué batalla selló la independencia de Venezuela?",
                opciones: ["Carabobo", "Boyacá", "Pichincha", "Junín"],
                respuesta: "Carabobo",
                retroalimentacion: "Carabobo fue decisiva en 1821.",
              },
              {
                enunciado: "¿Qué documento firmó la independencia de Venezuela?",
                opciones: ["Acta de 1811", "Constitución de 1830", "Grito de Dolores", "Tratado de Tordesillas"],
                respuesta: "Acta de 1811",
                retroalimentacion: "El 5 de julio se firmó el Acta.",
              },
              {
                enunciado: "¿Qué revolución terminó en 1959 en Cuba?",
                opciones: ["Revolución Cubana", "Revolución Gloriosa", "Revolución Industrial", "Revolución Cultural"],
                respuesta: "Revolución Cubana",
                retroalimentacion: "Fidel Castro lideró la Revolución Cubana.",
              },
              {
                enunciado: "¿Qué líder cubano encabezó la revolución?",
                opciones: ["Fidel Castro", "Che Guevara", "Batista", "Allende"],
                respuesta: "Fidel Castro",
                retroalimentacion: "Fidel Castro lideró el movimiento.",
              },
              {
                enunciado: "¿Qué movimiento buscó abolir la esclavitud en el siglo XIX?",
                opciones: ["Abolicionismo", "Mercantilismo", "Colonialismo", "Nacionalismo"],
                respuesta: "Abolicionismo",
                retroalimentacion: "El abolicionismo luchó contra la esclavitud.",
              },
              {
                enunciado: "¿Qué tratado terminó la Primera Guerra Mundial?",
                opciones: ["Tratado de Versalles", "Tratado de Utrecht", "Tratado de París", "Tratado de Viena"],
                respuesta: "Tratado de Versalles",
                retroalimentacion: "Versalles se firmó en 1919.",
              },
            ],
            preguntasDificiles: [
              {
                enunciado: "¿Qué texto ilustrado inspiró la soberanía popular en Francia?",
                opciones: ["El contrato social", "El príncipe", "Leviatán", "Utopía"],
                respuesta: "El contrato social",
                retroalimentacion: "Rousseau defendió la soberanía popular.",
              },
              {
                enunciado: "¿Qué golpe de Estado llevó a Napoleón al poder en 1799?",
                opciones: ["18 de Brumario", "Termidor", "Asalto a la Bastilla", "Directorio"],
                respuesta: "18 de Brumario",
                retroalimentacion: "El 18 de Brumario puso fin al Directorio.",
              },
              {
                enunciado: "¿Qué documento estadounidense de 1776 proclamó la independencia?",
                opciones: ["Declaración de Independencia", "Constitución", "Bill of Rights", "Artículos de Confederación"],
                respuesta: "Declaración de Independencia",
                retroalimentacion: "Jefferson redactó la declaración en 1776.",
              },
              {
                enunciado: "¿Qué invento impulsó la minería durante la Revolución Industrial?",
                opciones: ["Bomba de vapor de Watt", "Telar Jacquard", "Horno Bessemer", "Dinamo"],
                respuesta: "Bomba de vapor de Watt",
                retroalimentacion: "Las bombas de vapor drenaron minas profundas.",
              },
              {
                enunciado: "¿Qué reforma laboral impulsó el movimiento cartista?",
                opciones: ["Sufragio y representación", "Jornada de ocho horas", "Seguro social", "Salario mínimo"],
                respuesta: "Sufragio y representación",
                retroalimentacion: "El cartismo buscaba reformas políticas amplias.",
              },
              {
                enunciado: "¿Qué proceso económico se aceleró con los cercamientos en Inglaterra?",
                opciones: ["Éxodo rural", "Feudalismo", "Artesanado urbano", "Mercantilismo"],
                respuesta: "Éxodo rural",
                retroalimentacion: "Los cercamientos desplazaron campesinos.",
              },
              {
                enunciado: "¿Qué revolución liberal comenzó en España en 1820?",
                opciones: ["Trienio Liberal", "Revolución Gloriosa", "Guerra de Sucesión", "Bienio Progresista"],
                respuesta: "Trienio Liberal",
                retroalimentacion: "El Trienio Liberal restauró la Constitución.",
              },
              {
                enunciado: "¿Qué líder haitiano proclamó la independencia en 1804?",
                opciones: ["Jean-Jacques Dessalines", "Toussaint Louverture", "Henri Christophe", "Petión"],
                respuesta: "Jean-Jacques Dessalines",
                retroalimentacion: "Dessalines declaró la independencia haitiana.",
              },
              {
                enunciado: "¿Qué movimiento social surgió contra la mecanización en Inglaterra?",
                opciones: ["Ludismo", "Abolicionismo", "Sindicalismo", "Sufragismo"],
                respuesta: "Ludismo",
                retroalimentacion: "Los luditas destruían máquinas.",
              },
              {
                enunciado: "¿Qué congreso reorganizó Europa tras las guerras napoleónicas?",
                opciones: ["Congreso de Viena", "Congreso de Berlín", "Congreso de París", "Congreso de Verona"],
                respuesta: "Congreso de Viena",
                retroalimentacion: "Viena rediseñó el mapa europeo.",
              },
              {
                enunciado: "¿Qué movimiento independentista fue liderado por Toussaint Louverture?",
                opciones: ["Revolución haitiana", "Revolución cubana", "Revolución mexicana", "Revolución rusa"],
                respuesta: "Revolución haitiana",
                retroalimentacion: "Louverture lideró la rebelión de esclavos.",
              },
              {
                enunciado: "¿Qué documento venezolano de 1811 proclamó la independencia?",
                opciones: ["Acta de Independencia", "Constitución de 1811", "Manifiesto de Cartagena", "Congreso de Angostura"],
                respuesta: "Acta de Independencia",
                retroalimentacion: "El acta del 5 de julio formalizó la ruptura.",
              },
              {
                enunciado: "¿Qué pensador influyó en el socialismo utópico con falansterios?",
                opciones: ["Charles Fourier", "Karl Marx", "Adam Smith", "Bentham"],
                respuesta: "Charles Fourier",
                retroalimentacion: "Fourier propuso comunidades cooperativas.",
              },
              {
                enunciado: "¿Qué líder impulsó la unificación italiana desde el Piamonte?",
                opciones: ["Cavour", "Garibaldi", "Mazzini", "Víctor Manuel II"],
                respuesta: "Cavour",
                retroalimentacion: "Cavour lideró la diplomacia del Risorgimento.",
              },
              {
                enunciado: "¿Qué revolución de 1830 instaló a Luis Felipe en Francia?",
                opciones: ["Revolución de Julio", "Revolución de Febrero", "Revolución de 1848", "Comuna de París"],
                respuesta: "Revolución de Julio",
                retroalimentacion: "La Revolución de Julio inició la Monarquía de Julio.",
              },
              {
                enunciado: "¿Qué documento abolió la esclavitud en el Imperio británico?",
                opciones: ["Slavery Abolition Act", "Magna Carta", "Bill of Rights", "Reform Act"],
                respuesta: "Slavery Abolition Act",
                retroalimentacion: "El acta de 1833 abolió la esclavitud.",
              },
              {
                enunciado: "¿Qué grupo lideró la Revolución de Octubre en Rusia?",
                opciones: ["Bolcheviques", "Mencheviques", "Zaristas", "SR"],
                respuesta: "Bolcheviques",
                retroalimentacion: "Los bolcheviques tomaron el Palacio de Invierno.",
              },
              {
                enunciado: "¿Qué documento mexicano de 1917 avanzó derechos sociales?",
                opciones: ["Constitución de 1917", "Plan de Iguala", "Plan de San Luis", "Ley Lerdo"],
                respuesta: "Constitución de 1917",
                retroalimentacion: "La constitución incluyó derechos laborales y agrarios.",
              },
              {
                enunciado: "¿Qué revolución latinoamericana comenzó en 1959?",
                opciones: ["Revolución Cubana", "Revolución Sandinista", "Revolución Boliviana", "Revolución Haitiana"],
                respuesta: "Revolución Cubana",
                retroalimentacion: "La revolución cubana triunfó en 1959.",
              },
              {
                enunciado: "¿Qué acuerdo laboral se logró con el movimiento obrero europeo?",
                opciones: ["Jornada de ocho horas", "Sufragio universal", "Libre comercio", "Oro estándar"],
                respuesta: "Jornada de ocho horas",
                retroalimentacion: "La jornada de ocho horas fue una conquista obrera.",
              },
            ],
          },
          {
            nombre: "Siglo XX",
            descripcion: "Guerras mundiales, tecnología y geopolítica.",
            preguntas: [
              {
                enunciado: "¿Qué conflicto inició en 1914?",
                opciones: ["Primera Guerra Mundial", "Guerra Fría", "Guerra de Crimea", "Guerra de los Cien Años"],
                respuesta: "Primera Guerra Mundial",
                retroalimentacion: "La Primera Guerra Mundial inició en 1914.",
              },
              {
                enunciado: "¿Qué evento desencadenó la Primera Guerra Mundial?",
                opciones: ["Asesinato de Sarajevo", "Revolución Rusa", "Tratado de Versalles", "Ataque a Pearl Harbor"],
                respuesta: "Asesinato de Sarajevo",
                retroalimentacion: "El asesinato del archiduque fue la chispa.",
              },
              {
                enunciado: "¿Qué organización surgió tras la Segunda Guerra Mundial?",
                opciones: ["ONU", "OTAN", "Unión Europea", "Liga Hanseática"],
                respuesta: "ONU",
                retroalimentacion: "La ONU se fundó en 1945.",
              },
              {
                enunciado: "¿Qué país lanzó la bomba atómica en 1945?",
                opciones: ["Estados Unidos", "Alemania", "Japón", "URSS"],
                respuesta: "Estados Unidos",
                retroalimentacion: "EE.UU. lanzó bombas en Hiroshima y Nagasaki.",
              },
              {
                enunciado: "¿Qué alianza se formó en 1949?",
                opciones: ["OTAN", "Pacto de Varsovia", "ASEAN", "OEA"],
                respuesta: "OTAN",
                retroalimentacion: "La OTAN nació en 1949.",
              },
              {
                enunciado: "¿Qué muro cayó en 1989?",
                opciones: ["Muro de Berlín", "Muralla China", "Muro de Adriano", "Muro de Varsovia"],
                respuesta: "Muro de Berlín",
                retroalimentacion: "La caída del muro simbolizó el fin de la Guerra Fría.",
              },
              {
                enunciado: "¿Qué conflicto enfrentó a EE.UU. y la URSS?",
                opciones: ["Guerra Fría", "Guerra de Corea", "Guerra de Vietnam", "Guerra del Golfo"],
                respuesta: "Guerra Fría",
                retroalimentacion: "Fue un conflicto ideológico y geopolítico.",
              },
              {
                enunciado: "¿Qué carrera tecnológica marcó la Guerra Fría?",
                opciones: ["Carrera espacial", "Carrera naval", "Carrera armamentista", "Carrera comercial"],
                respuesta: "Carrera espacial",
                retroalimentacion: "La carrera espacial impulsó la tecnología.",
              },
              {
                enunciado: "¿Quién fue el primer humano en la Luna?",
                opciones: ["Neil Armstrong", "Yuri Gagarin", "Buzz Aldrin", "John Glenn"],
                respuesta: "Neil Armstrong",
                retroalimentacion: "Armstrong llegó a la Luna en 1969.",
              },
              {
                enunciado: "¿Qué país fue potencia del bloque oriental?",
                opciones: ["URSS", "Reino Unido", "Francia", "Italia"],
                respuesta: "URSS",
                retroalimentacion: "La URSS lideró el bloque oriental.",
              },
              {
                enunciado: "¿Qué conflicto se libró en Vietnam?",
                opciones: ["Guerra de Vietnam", "Guerra de Corea", "Guerra del Golfo", "Guerra Civil Española"],
                respuesta: "Guerra de Vietnam",
                retroalimentacion: "Vietnam fue un conflicto de la Guerra Fría.",
              },
              {
                enunciado: "¿Qué país fue dividido en dos después de 1945?",
                opciones: ["Alemania", "España", "Brasil", "Canadá"],
                respuesta: "Alemania",
                retroalimentacion: "Alemania se dividió en RFA y RDA.",
              },
              {
                enunciado: "¿Qué evento inició la Segunda Guerra Mundial?",
                opciones: ["Invasión de Polonia", "Ataque a Pearl Harbor", "Revolución China", "Guerra Civil Española"],
                respuesta: "Invasión de Polonia",
                retroalimentacion: "Alemania invadió Polonia en 1939.",
              },
              {
                enunciado: "¿Qué líder encabezó la India independiente?",
                opciones: ["Mahatma Gandhi", "Churchill", "Mandela", "Nehru"],
                respuesta: "Mahatma Gandhi",
                retroalimentacion: "Gandhi lideró la independencia con no violencia.",
              },
              {
                enunciado: "¿Qué líder sudafricano luchó contra el apartheid?",
                opciones: ["Nelson Mandela", "Desmond Tutu", "De Klerk", "Mbeki"],
                respuesta: "Nelson Mandela",
                retroalimentacion: "Mandela fue símbolo de la lucha antiapartheid.",
              },
              {
                enunciado: "¿Qué organización busca la cooperación económica en Europa?",
                opciones: ["Unión Europea", "OTAN", "ONU", "OEA"],
                respuesta: "Unión Europea",
                retroalimentacion: "La UE integra economías europeas.",
              },
              {
                enunciado: "¿Qué revolución tecnológica marcó finales del siglo XX?",
                opciones: ["Internet", "Imprenta", "Máquina de vapor", "Telégrafo"],
                respuesta: "Internet",
                retroalimentacion: "Internet cambió la comunicación global.",
              },
              {
                enunciado: "¿Qué conflicto ocurrió en 1991 en el Golfo?",
                opciones: ["Guerra del Golfo", "Guerra de Corea", "Guerra Civil Española", "Guerra de los Balcanes"],
                respuesta: "Guerra del Golfo",
                retroalimentacion: "La Guerra del Golfo inició en 1991.",
              },
              {
                enunciado: "¿Qué país lanzó el primer satélite artificial?",
                opciones: ["URSS", "Estados Unidos", "China", "Francia"],
                respuesta: "URSS",
                retroalimentacion: "La URSS lanzó el Sputnik en 1957.",
              },
              {
                enunciado: "¿Qué líder fue primer ministro del Reino Unido en la Segunda Guerra Mundial?",
                opciones: ["Winston Churchill", "Thatcher", "Chamberlain", "Attlee"],
                respuesta: "Winston Churchill",
                retroalimentacion: "Churchill lideró al Reino Unido durante la guerra.",
              },
            ],
            preguntasDificiles: [
              {
                enunciado: "¿Qué crisis de 1962 llevó al mundo al borde de la guerra nuclear?",
                opciones: ["Crisis de los misiles en Cuba", "Crisis de Suez", "Bloqueo de Berlín", "Guerra de Yom Kipur"],
                respuesta: "Crisis de los misiles en Cuba",
                retroalimentacion: "La crisis cubana fue el punto más tenso de la Guerra Fría.",
              },
              {
                enunciado: "¿Qué conferencia de 1945 sentó las bases del orden de posguerra?",
                opciones: ["Conferencia de Yalta", "Conferencia de Potsdam", "Conferencia de Bandung", "Conferencia de San Francisco"],
                respuesta: "Conferencia de Yalta",
                retroalimentacion: "Yalta definió esferas de influencia aliadas.",
              },
              {
                enunciado: "¿Qué plan económico estadounidense buscó reconstruir Europa?",
                opciones: ["Plan Marshall", "Plan Dawes", "New Deal", "Plan Schuman"],
                respuesta: "Plan Marshall",
                retroalimentacion: "El Plan Marshall financió la reconstrucción europea.",
              },
              {
                enunciado: "¿Qué guerra marcó la descolonización francesa en Indochina?",
                opciones: ["Guerra de Indochina", "Guerra de Argelia", "Guerra de Corea", "Guerra de Suez"],
                respuesta: "Guerra de Indochina",
                retroalimentacion: "La derrota en Dien Bien Phu cerró el conflicto.",
              },
              {
                enunciado: "¿Qué doctrina impulsó la contención del comunismo en EE.UU.?",
                opciones: ["Doctrina Truman", "Doctrina Monroe", "Doctrina Brezhnev", "Doctrina Nixon"],
                respuesta: "Doctrina Truman",
                retroalimentacion: "La doctrina Truman defendía la contención.",
              },
              {
                enunciado: "¿Qué evento de 1968 simbolizó la Primavera de Praga?",
                opciones: ["Reformas de Dubček", "Caída del Muro", "Guerra de los Seis Días", "Revolución Cultural"],
                respuesta: "Reformas de Dubček",
                retroalimentacion: "Dubček intentó un socialismo con rostro humano.",
              },
              {
                enunciado: "¿Qué movimiento surgió en Polonia en 1980 contra el régimen comunista?",
                opciones: ["Solidaridad", "Carta 77", "Perestroika", "Glasnost"],
                respuesta: "Solidaridad",
                retroalimentacion: "Solidaridad lideró Lech Wałęsa.",
              },
              {
                enunciado: "¿Qué país detonó su primera bomba atómica en 1949?",
                opciones: ["URSS", "Reino Unido", "Francia", "China"],
                respuesta: "URSS",
                retroalimentacion: "La URSS probó su arma nuclear en 1949.",
              },
              {
                enunciado: "¿Qué guerra se considera el primer conflicto de la Guerra Fría?",
                opciones: ["Guerra de Corea", "Guerra de Vietnam", "Guerra del Golfo", "Guerra Civil China"],
                respuesta: "Guerra de Corea",
                retroalimentacion: "Corea enfrentó bloques en 1950.",
              },
              {
                enunciado: "¿Qué tratado creó la Comunidad Económica Europea en 1957?",
                opciones: ["Tratado de Roma", "Tratado de Maastricht", "Tratado de París", "Tratado de Lisboa"],
                respuesta: "Tratado de Roma",
                retroalimentacion: "Roma fundó la CEE.",
              },
              {
                enunciado: "¿Qué evento simbolizó el inicio de la Revolución Cultural china?",
                opciones: ["Campaña contra las Cuatro Viejas", "Gran Salto Adelante", "Reforma de Deng", "Guerra del Opio"],
                respuesta: "Campaña contra las Cuatro Viejas",
                retroalimentacion: "La Revolución Cultural atacó tradiciones y cultura.",
              },
              {
                enunciado: "¿Qué acuerdo de 1975 buscó aliviar tensiones en Europa?",
                opciones: ["Acta Final de Helsinki", "Tratado INF", "Acuerdos SALT", "Pacto de Varsovia"],
                respuesta: "Acta Final de Helsinki",
                retroalimentacion: "Helsinki promovió derechos y seguridad.",
              },
              {
                enunciado: "¿Qué guerra ocurrió entre Irán e Irak en los años 80?",
                opciones: ["Guerra Irán-Irak", "Guerra del Golfo", "Guerra de los Seis Días", "Guerra de Afganistán"],
                respuesta: "Guerra Irán-Irak",
                retroalimentacion: "Fue un conflicto prolongado de 1980-1988.",
              },
              {
                enunciado: "¿Qué líder soviético impulsó la perestroika?",
                opciones: ["Mijaíl Gorbachov", "Leonid Brézhnev", "Nikita Jrushchov", "Yuri Andrópov"],
                respuesta: "Mijaíl Gorbachov",
                retroalimentacion: "Gorbachov impulsó reformas económicas.",
              },
              {
                enunciado: "¿Qué conflicto marcó la independencia de Argelia?",
                opciones: ["Guerra de Argelia", "Guerra de Suez", "Guerra de Indochina", "Guerra de Biafra"],
                respuesta: "Guerra de Argelia",
                retroalimentacion: "La guerra terminó con la independencia en 1962.",
              },
              {
                enunciado: "¿Qué tratado de 1991 disolvió oficialmente la URSS?",
                opciones: ["Acuerdos de Belavezha", "Tratado de Varsovia", "Tratado de Roma", "Tratado de Helsinki"],
                respuesta: "Acuerdos de Belavezha",
                retroalimentacion: "Belavezha certificó la disolución soviética.",
              },
              {
                enunciado: "¿Qué conflicto de 1956 afectó el control del canal en Egipto?",
                opciones: ["Crisis de Suez", "Guerra de Yom Kipur", "Guerra de los Seis Días", "Guerra del Golfo"],
                respuesta: "Crisis de Suez",
                retroalimentacion: "Suez involucró a Egipto, Reino Unido y Francia.",
              },
              {
                enunciado: "¿Qué país lideró el Movimiento de Países No Alineados junto a India?",
                opciones: ["Yugoslavia", "Egipto", "Indonesia", "Ghana"],
                respuesta: "Yugoslavia",
                retroalimentacion: "Tito fue clave en el movimiento no alineado.",
              },
              {
                enunciado: "¿Qué guerra en 1999 involucró a la OTAN en los Balcanes?",
                opciones: ["Guerra de Kosovo", "Guerra de Bosnia", "Guerra de Croacia", "Guerra de Chechenia"],
                respuesta: "Guerra de Kosovo",
                retroalimentacion: "La OTAN intervino en Kosovo.",
              },
              {
                enunciado: "¿Qué proyecto estadounidense dio origen a Internet?",
                opciones: ["ARPANET", "Mercury", "Apollo", "Manhattan"],
                respuesta: "ARPANET",
                retroalimentacion: "ARPANET fue la base de Internet.",
              },
            ],
          },
        ],
        indiceCategoriaActual: 0,
        indicePreguntaActual: 0,
        vidas: 3,
        puntaje: 0,
        ordenPreguntas: [],
        tiempoLimite: 30,
        tiempoRestante: 30,
        preguntaEspecial: false,
        preguntaActual: null,
        dificultad: "normal",
        configuracion: {
          vidasIniciales: 5,
          tiempoPregunta: 30,
          tiempoEspecial: 10,
          probabilidadEspecial: 0.1,
          vidasExtraEspecial: 1,
          antiTrampa: true,
          comodines: { pista: 1, saltar: 1, investigar: 1, eliminar: 1 },
          puedeGuardar: true,
        },
        comodines: {
          pista: 1,
          saltar: 1,
          investigar: 1,
          eliminar: 1,
        },
        permitirSalidaHasta: 0,
        respuestasCorrectas: 0,
        respuestasIncorrectas: 0,
        partidaIniciada: false,
      };

      let contenedorCategorias;
      let etiquetaCategoria;
      let etiquetaNivel;
      let etiquetaVidas;
      let etiquetaPuntaje;
      let textoPregunta;
      let contenedorOpciones;
      let textoFeedback;
      let estadoGuardado;
      let entradaNombre;
      let listaGuardados;
      let etiquetaTiempo;
      let botonPista;
      let botonSaltar;
      let botonInvestigar;
      let botonEliminar;
      let temporizador;
      let temporizadorInvestigar;
      let tiempoInvestigacionRestante = 0;
      let selectorDificultad;
      let textoDificultad;
      let burbujaDificultad;
      let rellenoDificultad;
      let overlayInicio;
      let overlayNuevaPartida;
      let overlayGestorPartidas;
      let inicioNombrePartida;
      let inicioCategoria;
      let inicioDificultad;
      let listaGuardadosGestor;
      let botonTerminarPartida;
      let inicioDificultadNombre;
      let inicioDificultadFill;
      let inicioDificultadResumen;
      let panelComodines;
      let seguridadDesbloqueada = false;
      let overlayActual = null;


      function activarBloqueoSeguridad() {
        if (seguridadDesbloqueada) {
          return;
        }
        document.body.classList.add("bloqueo-seguridad");
      }

      function desactivarBloqueoSeguridadTemporal() {
        seguridadDesbloqueada = true;
        document.body.classList.remove("bloqueo-seguridad");
      }

      function restaurarBloqueoSeguridad() {
        seguridadDesbloqueada = false;
        document.body.classList.add("bloqueo-seguridad");
      }

      function bloquearEventosSeguridad(evento) {
        if (seguridadDesbloqueada) {
          return;
        }
        evento.preventDefault();
      }

      function animarOverlay(overlay, { direccion = 1, saliendo = false } = {}) {
        if (!overlay || !window.gsap) {
          return;
        }
        const panel = overlay.querySelector(".theme-panel");
        if (saliendo) {
          gsap.to(panel, {
            x: -80 * direccion,
            opacity: 0,
            duration: 0.22,
            ease: "power1.in",
          });
          return;
        }
        gsap.fromTo(panel, { x: 80 * direccion, opacity: 0 }, { x: 0, opacity: 1, duration: 0.32, ease: "power2.out" });
      }

      function obtenerDireccionTransicion(origen, destino) {
        if (!origen || !destino || origen === destino) {
          return 1;
        }
        if (origen === overlayInicio && (destino === overlayNuevaPartida || destino === overlayGestorPartidas)) {
          return 1;
        }
        if ((origen === overlayNuevaPartida || origen === overlayGestorPartidas) && destino === overlayInicio) {
          return -1;
        }
        if (origen === overlayNuevaPartida && destino === overlayGestorPartidas) {
          return 1;
        }
        if (origen === overlayGestorPartidas && destino === overlayNuevaPartida) {
          return -1;
        }
        return 1;
      }

      function mostrarSoloOverlay(overlayActivo) {
        const direccion = obtenerDireccionTransicion(overlayActual, overlayActivo);
        const anterior = overlayActual;
        [overlayInicio, overlayNuevaPartida, overlayGestorPartidas].forEach((overlay) => {
          if (overlay !== anterior && overlay !== overlayActivo) {
            overlay.classList.add("oculto");
          }
        });
        if (anterior && anterior !== overlayActivo && overlayActivo) {
          animarOverlay(anterior, { direccion, saliendo: true });
          setTimeout(() => {
            if (overlayActual !== anterior) {
              anterior.classList.add("oculto");
            }
          }, 220);
        } else if (anterior && anterior !== overlayActivo) {
          anterior.classList.add("oculto");
        }
        if (overlayActivo) {
          overlayActivo.classList.remove("oculto");
          animarOverlay(overlayActivo, { direccion });
        }
        overlayActual = overlayActivo;
      }

      function resetearTemaMenuInicio() {
        document.body.dataset.theme = "normal";
        if (inicioDificultad) {
          inicioDificultad.value = "2";
          actualizarSelectorInicioDificultad();
        }
      }

      function volverAlMenuInicio(mensaje = "Volviste al menú de inicio.") {
        estado.partidaIniciada = false;
        estado.permitirSalidaHasta = 0;
        detenerTemporizador();
        detenerTemporizadorInvestigacion();
        mostrarSoloOverlay(overlayInicio);
        resetearTemaMenuInicio();
        estadoGuardado.textContent = mensaje;
      }

      function iniciarPartidaDesdeMenu() {
        const nivel = NIVELES_DIFICULTAD[Number(inicioDificultad.value)] ?? "normal";
        actualizarSelectorInicioDificultad();
        const categoriaSeleccionada = Number(inicioCategoria.value || 0);
        aplicarDificultad(nivel);
        estado.indiceCategoriaActual = categoriaSeleccionada;
        estado.indicePreguntaActual = 0;
        estado.vidas = estado.configuracion.vidasIniciales;
        estado.puntaje = 0;
        estado.respuestasCorrectas = 0;
        estado.respuestasIncorrectas = 0;
        estado.ordenPreguntas = obtenerOrdenAleatorio(obtenerTotalPreguntas(estado.categorias[estado.indiceCategoriaActual]));
        estado.comodines = { ...estado.configuracion.comodines };
        estado.partidaIniciada = true;
        if (panelComodines) {
          panelComodines.classList.remove("hidden");
        }
        if (inicioNombrePartida.value.trim()) {
          entradaNombre.value = inicioNombrePartida.value.trim();
        }
        mostrarSoloOverlay(null);
        actualizarJuego();
        estadoGuardado.textContent = "Nueva partida iniciada.";
      }

      function abrirGestorPartidas() {
        renderizarGuardados();
        mostrarSoloOverlay(overlayGestorPartidas);
      }

      // Renderiza las tarjetas de categorías según el estado actual.
      function renderizarCategorias() {
        contenedorCategorias.innerHTML = "";
        estado.categorias.forEach((categoria) => {
          const tarjeta = document.createElement("div");
          tarjeta.className =
            "theme-card card-categoria tarjeta-transicion rounded-2xl bg-slate-50 p-4 text-left shadow-inner";
          tarjeta.innerHTML = `
            <p class="text-sm font-semibold text-slate-800">${categoria.nombre}</p>
            <p class="text-xs text-slate-400">${categoria.descripcion}</p>
            <p class="mt-2 text-xs text-indigo-500 font-semibold">${obtenerTotalPreguntas(categoria)} preguntas</p>
          `;
          contenedorCategorias.appendChild(tarjeta);
        });
        if (window.gsap) {
          gsap.fromTo("#categorias .card-categoria", { y: 12, opacity: 0 }, { y: 0, opacity: 1, stagger: 0.05, duration: 0.35, ease: "power2.out" });
        }
      }

      // Refresca estadísticas, categoría y nivel en pantalla.
      function actualizarEstado() {
        etiquetaVidas.textContent = obtenerTextoVidas();
        etiquetaPuntaje.textContent = estado.puntaje;
        etiquetaTiempo.textContent = estado.tiempoRestante;
        const categoria = estado.categorias[estado.indiceCategoriaActual];
        etiquetaCategoria.textContent = categoria.nombre;
        etiquetaNivel.textContent = "Reto activo";
      }

      // Usa el infinito en modo principiante (vidas ilimitadas).
      function obtenerTextoVidas() {
        return estado.configuracion.vidasIniciales === 0 ? "∞" : estado.vidas;
      }

      // Configuración base por dificultad (vidas, tiempos, probabilidad especial, comodines).
      function obtenerConfiguracion(dificultad) {
        switch (dificultad) {
          case "principiante":
            return {
              vidasIniciales: 0,
              tiempoPregunta: 30,
              tiempoEspecial: 0,
              probabilidadEspecial: 0,
              vidasExtraEspecial: 0,
              antiTrampa: false,
              comodines: { pista: 0, saltar: 0, investigar: 0, eliminar: 0 },
              puedeGuardar: true,
            };
          case "facil":
            return {
              vidasIniciales: 10,
              tiempoPregunta: 30,
              tiempoEspecial: 10,
              probabilidadEspecial: 0.1,
              vidasExtraEspecial: 1,
              antiTrampa: true,
              comodines: { pista: 2, saltar: 2, investigar: 2, eliminar: 2 },
              puedeGuardar: true,
            };
          case "dificil":
            return {
              vidasIniciales: 3,
              tiempoPregunta: 20,
              tiempoEspecial: 5,
              probabilidadEspecial: 0.05,
              vidasExtraEspecial: 1,
              antiTrampa: true,
              comodines: { pista: 0, saltar: 0, investigar: 0, eliminar: 0 },
              puedeGuardar: true,
            };
          case "hardcore":
            return {
              vidasIniciales: 1,
              tiempoPregunta: 10,
              tiempoEspecial: 0,
              probabilidadEspecial: 0,
              vidasExtraEspecial: 0,
              antiTrampa: true,
              comodines: { pista: 0, saltar: 0, investigar: 0, eliminar: 0 },
              puedeGuardar: false,
            };
          default:
            return {
              vidasIniciales: 5,
              tiempoPregunta: 30,
              tiempoEspecial: 10,
              probabilidadEspecial: 0.1,
              vidasExtraEspecial: 1,
              antiTrampa: true,
              comodines: { pista: 1, saltar: 1, investigar: 1, eliminar: 1 },
              puedeGuardar: true,
            };
        }
      }

      // Combina preguntas normales y avanzadas en difícil/hardcore.
      function obtenerPreguntasActivas(categoria) {
        if (["dificil", "hardcore"].includes(estado.dificultad) && categoria.preguntasDificiles) {
          return categoria.preguntas.concat(categoria.preguntasDificiles);
        }
        return categoria.preguntas;
      }

      function obtenerTotalPreguntas(categoria) {
        return obtenerPreguntasActivas(categoria).length;
      }

      function obtenerEtiquetaDificultad(nivel) {
        const etiquetas = {
          principiante: "Principiante",
          facil: "Fácil",
          normal: "Normal",
          dificil: "Difícil",
          hardcore: "Hardcore",
        };
        return etiquetas[nivel] ?? "Normal";
      }

      function obtenerColorDificultad(nivel) {
        const colores = {
          principiante: "#f59e0b",
          facil: "#22c55e",
          normal: "#6366f1",
          dificil: "#ef4444",
          hardcore: "#000000",
        };
        return colores[nivel] ?? "#6366f1";
      }


      function renderizarResumenDificultad(nivel) {
        if (!inicioDificultadResumen) {
          return;
        }
        const cfg = obtenerConfiguracion(nivel);
        const etiqueta = obtenerEtiquetaDificultad(nivel);
        const totalComodines = Object.values(cfg.comodines).reduce((acc, v) => acc + v, 0);
        const porcentajeEspecial = Math.round((cfg.probabilidadEspecial || 0) * 100);
        const vidasTexto = cfg.vidasIniciales === 0 ? "Infinitas" : String(cfg.vidasIniciales);
        const especial = cfg.tiempoEspecial > 0 ? `${cfg.tiempoEspecial}s` : "No aplica";
        inicioDificultadResumen.classList.add("animando");
        setTimeout(() => {
          inicioDificultadResumen.innerHTML = `
            <p class="text-xs font-bold uppercase tracking-[0.18em] text-slate-600">Resumen del modo ${etiqueta}</p>
            <ul class="mt-2 space-y-1 text-xs text-slate-700">
              <li>• Vidas iniciales: <span class="font-semibold">${vidasTexto}</span></li>
              <li>• Tiempo por pregunta: <span class="font-semibold">${cfg.tiempoPregunta}s</span></li>
              <li>• Preguntas especiales: <span class="font-semibold">${porcentajeEspecial}%</span> (${especial})</li>
              <li>• Comodines totales: <span class="font-semibold">${totalComodines}</span> ${totalComodines === 0 ? "(desactivados)" : ""}</li>
              <li>• Guardado: <span class="font-semibold">${cfg.puedeGuardar ? "Sí" : "No"}</span></li>
              <li>• Anti-trampa: <span class="font-semibold">${cfg.antiTrampa ? "Activo" : "Inactivo"}</span></li>
            </ul>
          `;
          inicioDificultadResumen.classList.remove("animando");
        }, 120);
      }

      function actualizarSelectorInicioDificultad() {
        if (!inicioDificultad || !inicioDificultadNombre) {
          return;
        }
        const nivel = NIVELES_DIFICULTAD[Number(inicioDificultad.value)] ?? "normal";
        const etiqueta = obtenerEtiquetaDificultad(nivel);
        const color = obtenerColorDificultad(nivel);
        const indice = NIVELES_DIFICULTAD.indexOf(nivel);
        const porcentaje = indice <= 0 ? 0 : (indice / (NIVELES_DIFICULTAD.length - 1)) * 100;
        inicioDificultadNombre.textContent = etiqueta;
        inicioDificultadNombre.style.setProperty("--badge-color", color);
        inicioDificultadNombre.style.color = nivel === "principiante" ? "#111827" : "#f8fafc";
        if (inicioDificultadFill) {
          inicioDificultadFill.style.width = `${porcentaje}%`;
          inicioDificultadFill.style.backgroundColor = color;
        }
        inicioDificultad.style.accentColor = color;
        inicioDificultad.style.setProperty("--slider-color", color);
        document.body.dataset.theme = nivel;
        renderizarResumenDificultad(nivel);
      }

      function mezclarArreglo(lista) {
        const copia = [...lista];
        for (let i = copia.length - 1; i > 0; i -= 1) {
          const j = Math.floor(Math.random() * (i + 1));
          [copia[i], copia[j]] = [copia[j], copia[i]];
        }
        return copia;
      }


      // Sincroniza slider, burbuja y tema visual con la dificultad actual.
      function actualizarSliderDificultad(nivel) {
        const indice = NIVELES_DIFICULTAD.includes(nivel) ? NIVELES_DIFICULTAD.indexOf(nivel) : 2;
        const porcentaje = indice <= 0 ? 0 : (indice / (NIVELES_DIFICULTAD.length - 1)) * 100;
        if (selectorDificultad) {
          selectorDificultad.value = indice;
        }
        if (rellenoDificultad) {
          rellenoDificultad.style.width = `${porcentaje}%`;
        }
        if (burbujaDificultad) {
          burbujaDificultad.style.left = `${porcentaje}%`;
          burbujaDificultad.textContent = obtenerEtiquetaDificultad(nivel);
        }
        document.body.dataset.theme = nivel;
      }

      // Aplica la dificultad y reinicia parámetros clave si corresponde.
      function aplicarDificultad(nivel, { reiniciar = true } = {}) {
        estado.dificultad = nivel;
        estado.configuracion = obtenerConfiguracion(nivel);
        if (reiniciar) {
          estado.vidas = estado.configuracion.vidasIniciales;
          estado.tiempoLimite = estado.configuracion.tiempoPregunta;
          estado.tiempoRestante = estado.configuracion.tiempoPregunta;
          estado.comodines = { ...estado.configuracion.comodines };
          estado.permitirSalidaHasta = 0;
          estado.indicePreguntaActual = 0;
          estado.ordenPreguntas = obtenerOrdenAleatorio(
            obtenerTotalPreguntas(estado.categorias[estado.indiceCategoriaActual])
          );
        } else {
          const totalPreguntas = obtenerTotalPreguntas(estado.categorias[estado.indiceCategoriaActual]);
          if (estado.ordenPreguntas.length !== totalPreguntas) {
            estado.ordenPreguntas = obtenerOrdenAleatorio(totalPreguntas);
          }
          estado.indicePreguntaActual = Math.min(estado.indicePreguntaActual, totalPreguntas - 1);
        }
        detenerTemporizadorInvestigacion();
        actualizarSliderDificultad(nivel);
        renderizarCategorias();
        actualizarComodines();
        actualizarEstado();
        if (textoDificultad) {
          textoDificultad.textContent = `Modo ${obtenerEtiquetaDificultad(nivel)} activado.`;
        }
      }

      // Genera la siguiente pregunta y pinta las opciones.
      function actualizarPregunta() {
        const categoria = estado.categorias[estado.indiceCategoriaActual];
        const preguntasActivas = obtenerPreguntasActivas(categoria);
        if (!estado.ordenPreguntas.length || estado.ordenPreguntas.length !== preguntasActivas.length) {
          estado.ordenPreguntas = obtenerOrdenAleatorio(preguntasActivas.length);
        }
        const pregunta = seleccionarPregunta(categoria, preguntasActivas);
        estado.preguntaActual = pregunta;
        if (!pregunta) {
          textoPregunta.textContent = "¡Categoría completada!";
          contenedorOpciones.innerHTML = "";
          textoFeedback.textContent = "Excelente trabajo. Puedes elegir otra categoría.";
          guardarPartida();
          return;
        }
        textoPregunta.textContent = pregunta.enunciado;
        contenedorOpciones.innerHTML = "";
        const opcionesAleatorias = mezclarArreglo(pregunta.opciones);
        opcionesAleatorias.forEach((opcion) => {
          const boton = document.createElement("button");
          boton.className =
            "rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm font-semibold text-slate-700 shadow-sm transition hover:-translate-y-0.5 hover:border-indigo-300 hover:text-indigo-600";
          boton.textContent = opcion;
          boton.addEventListener("click", () => manejarRespuesta(opcion, pregunta, boton));
          contenedorOpciones.appendChild(boton);
        });
        textoFeedback.textContent = "Selecciona la opción correcta.";
        iniciarTemporizador();
      }

      // Evalúa la respuesta y aplica consecuencias.
      function manejarRespuesta(opcionSeleccionada, pregunta, boton) {
        const esCorrecta = opcionSeleccionada === pregunta.respuesta;
        if (esCorrecta) {
          estado.puntaje += 10;
          estado.respuestasCorrectas += 1;
          boton.classList.add("anim-correcto", "bg-emerald-100", "text-emerald-700");
          textoFeedback.textContent = `✅ ${pregunta.retroalimentacion}`;
          lanzarConfeti();
          if (estado.preguntaEspecial && estado.configuracion.vidasExtraEspecial > 0) {
            estado.vidas += estado.configuracion.vidasExtraEspecial;
            textoFeedback.textContent += " ¡Pregunta especial! Ganaste una vida.";
          }
        } else {
          estado.respuestasIncorrectas += 1;
          if (estado.configuracion.vidasIniciales > 0) {
            estado.vidas -= 1;
          }
          boton.classList.add("anim-error", "bg-rose-100", "text-rose-700");
          const vidasTexto = obtenerTextoVidas();
          textoFeedback.textContent = `❌ ${pregunta.retroalimentacion} Te quedan ${vidasTexto} vidas.`;
          if (estado.dificultad === "hardcore") {
            perderPartida("Modo hardcore: fallaste la pregunta.");
            return;
          }
        }
        actualizarEstado();
        guardarPartida();
        if (estado.configuracion.vidasIniciales > 0 && estado.vidas <= 0) {
          perderPartida("Perdiste todas las vidas.");
          return;
        }
        setTimeout(() => {
          estado.indicePreguntaActual += 1;
          actualizarPregunta();
        }, 700);
      }

      // Actualiza todo el estado visible del juego.
      function actualizarJuego() {
        actualizarEstado();
        actualizarPregunta();
        actualizarComodines();
      }

      function obtenerGuardados() {
        const guardados = localStorage.getItem(CLAVE_LISTA_GUARDADOS);
        return guardados ? JSON.parse(guardados) : [];
      }

      function guardarLista(guardados) {
        localStorage.setItem(CLAVE_LISTA_GUARDADOS, JSON.stringify(guardados));
      }

      // Guarda el estado en localStorage (si la dificultad lo permite).
      function guardarPartida() {
        if (!estado.configuracion.puedeGuardar) {
          estadoGuardado.textContent = "En modo hardcore no se guardan partidas.";
          return;
        }
        const nombre = entradaNombre?.value?.trim();
        if (!nombre) {
          const categoria = estado.categorias[estado.indiceCategoriaActual]?.nombre ?? "Partida";
          const fecha = new Date().toLocaleDateString();
          entradaNombre.value = `${categoria} - ${fecha}`;
          estadoGuardado.textContent = "Escribe un nombre para guardar la partida.";
          return;
        }
        const datos = {
          indiceCategoriaActual: estado.indiceCategoriaActual,
          indicePreguntaActual: estado.indicePreguntaActual,
          vidas: estado.vidas,
          puntaje: estado.puntaje,
          ordenPreguntas: estado.ordenPreguntas,
          tiempoRestante: estado.tiempoRestante,
          tiempoLimite: estado.tiempoLimite,
          preguntaEspecial: estado.preguntaEspecial,
          comodines: estado.comodines,
          dificultad: estado.dificultad,
          vidasDisponibles: estado.vidas,
          respuestasCorrectas: estado.respuestasCorrectas,
          respuestasIncorrectas: estado.respuestasIncorrectas,
        };
        localStorage.setItem(CLAVE_GUARDADO, JSON.stringify(datos));

        const guardados = obtenerGuardados();
        const existente = guardados.find((item) => item.nombre === nombre);
        const maximoPuntaje = Math.max(existente?.maximoPuntaje ?? 0, estado.puntaje);
        const nivelDificultad = obtenerEtiquetaDificultad(datos.dificultad ?? estado.dificultad);
        const registro = {
          id: existente?.id ?? crypto.randomUUID(),
          nombre,
          fecha: new Date().toLocaleString(),
          maximoPuntaje,
          dificultad: nivelDificultad,
          datos,
        };
        if (existente) {
          guardados.splice(guardados.indexOf(existente), 1, registro);
        } else {
          guardados.unshift(registro);
        }
        guardarLista(guardados);
        renderizarGuardados();
        estadoGuardado.textContent = "Partida guardada correctamente.";
        entradaNombre.value = "";
      }

      function cargarPartida() {
        const guardado = localStorage.getItem(CLAVE_GUARDADO);
        if (!guardado) {
          estadoGuardado.textContent = "No hay partida guardada.";
          return false;
        }
        const datos = JSON.parse(guardado);
        estado.dificultad = datos.dificultad ?? estado.dificultad;
        estado.indiceCategoriaActual = datos.indiceCategoriaActual ?? 0;
        estado.indicePreguntaActual = datos.indicePreguntaActual ?? 0;
        estado.vidas = datos.vidas ?? 3;
        estado.puntaje = datos.puntaje ?? 0;
        estado.ordenPreguntas =
          datos.ordenPreguntas ??
          obtenerOrdenAleatorio(obtenerTotalPreguntas(estado.categorias[estado.indiceCategoriaActual]));
        estado.tiempoRestante = datos.tiempoRestante ?? 30;
        estado.tiempoLimite = datos.tiempoLimite ?? 30;
        estado.preguntaEspecial = datos.preguntaEspecial ?? false;
        estado.comodines = datos.comodines ?? { pista: 1, saltar: 1, investigar: 1, eliminar: 1 };
        estado.respuestasCorrectas = datos.respuestasCorrectas ?? 0;
        estado.respuestasIncorrectas = datos.respuestasIncorrectas ?? 0;
        if (datos.dificultad) {
          aplicarDificultad(datos.dificultad, { reiniciar: false });
        }
        estadoGuardado.textContent = "Partida cargada.";
        return true;
      }

      function cargarPartidaPorId(id) {
        const guardados = obtenerGuardados();
        const registro = guardados.find((item) => item.id === id);
        if (!registro) {
          estadoGuardado.textContent = "No se encontró la partida.";
          return;
        }
        estado.dificultad = registro.datos.dificultad ?? estado.dificultad;
        estado.indiceCategoriaActual = registro.datos.indiceCategoriaActual ?? 0;
        estado.indicePreguntaActual = registro.datos.indicePreguntaActual ?? 0;
        estado.vidas = registro.datos.vidas ?? 3;
        estado.puntaje = registro.datos.puntaje ?? 0;
        estado.ordenPreguntas =
          registro.datos.ordenPreguntas ??
          obtenerOrdenAleatorio(obtenerTotalPreguntas(estado.categorias[estado.indiceCategoriaActual]));
        estado.tiempoRestante = registro.datos.tiempoRestante ?? 30;
        estado.tiempoLimite = registro.datos.tiempoLimite ?? 30;
        estado.preguntaEspecial = registro.datos.preguntaEspecial ?? false;
        estado.comodines = registro.datos.comodines ?? { pista: 1, saltar: 1, investigar: 1, eliminar: 1 };
        estado.respuestasCorrectas = registro.datos.respuestasCorrectas ?? 0;
        estado.respuestasIncorrectas = registro.datos.respuestasIncorrectas ?? 0;
        if (registro.datos.dificultad) {
          aplicarDificultad(registro.datos.dificultad, { reiniciar: false });
        }
        localStorage.setItem(CLAVE_GUARDADO, JSON.stringify(registro.datos));
        estado.partidaIniciada = true;
        estadoGuardado.textContent = `Partida cargada: ${registro.nombre}`;
        actualizarJuego();
      }

      function obtenerOrdenAleatorio(total) {
        const indices = Array.from({ length: total }, (_, indice) => indice);
        for (let i = indices.length - 1; i > 0; i -= 1) {
          const j = Math.floor(Math.random() * (i + 1));
          [indices[i], indices[j]] = [indices[j], indices[i]];
        }
        return indices;
      }

      function renderizarGuardados() {
        if (!listaGuardados) {
          return;
        }
        const guardados = obtenerGuardados();
        listaGuardados.innerHTML = "";
        if (listaGuardadosGestor) {
          listaGuardadosGestor.innerHTML = "";
        }
        if (guardados.length === 0) {
          const vacio = document.createElement("p");
          vacio.className = "text-xs text-slate-400";
          vacio.textContent = "Sin partidas guardadas.";
          listaGuardados.appendChild(vacio);
          return;
        }
        guardados.forEach((registro) => {
          const boton = document.createElement("button");
          boton.className =
            "theme-card rounded-xl border border-slate-200 bg-white/90 px-3 py-2 text-left text-xs font-semibold text-slate-700 shadow-sm transition hover:-translate-y-0.5";
          const correctas = registro.datos?.respuestasCorrectas ?? 0;
          const incorrectas = registro.datos?.respuestasIncorrectas ?? 0;
          boton.innerHTML = `
            <div class="flex items-center justify-between gap-2">
              <div>
                <span>${registro.nombre}</span>
                <span class="block text-[10px] text-slate-400">Última vez: ${registro.fecha} · ${registro.dificultad ?? "Normal"}</span>
              </div>
              <span class="rounded-full bg-indigo-100 px-2 py-1 text-[10px] font-semibold text-indigo-600">
                Máx ${registro.maximoPuntaje}
              </span>
            </div>
          `;
          boton.addEventListener("click", () => cargarPartidaPorId(registro.id));
          listaGuardados.appendChild(boton);

          if (listaGuardadosGestor) {
            const tarjeta = document.createElement("article");
            tarjeta.className = "theme-card rounded-2xl border border-slate-200 bg-white/90 p-4 text-sm";
            tarjeta.innerHTML = `
              <p class="font-semibold text-slate-800">${registro.nombre}</p>
              <p class="text-xs text-slate-600">Última vez jugado: ${registro.fecha}</p>
              <p class="text-xs text-slate-600">Dificultad: ${registro.dificultad ?? "Normal"}</p>
              <p class="text-xs text-slate-600">Puntaje máximo: ${registro.maximoPuntaje}</p>
              <p class="text-xs text-slate-600">Vidas disponibles: ${registro.datos?.vidas ?? 0}</p>
              <p class="text-xs text-slate-600">Correctas: ${correctas} · Incorrectas: ${incorrectas}</p>
              <button class="mt-3 rounded-xl bg-indigo-600 px-3 py-2 text-xs font-semibold text-white" data-id="${registro.id}">Continuar partida</button>
            `;
            tarjeta.querySelector("button")?.addEventListener("click", () => {
              cargarPartidaPorId(registro.id);
              estado.partidaIniciada = true;
              mostrarSoloOverlay(null);
            });
            listaGuardadosGestor.appendChild(tarjeta);
          }
        });
      }

      function lanzarConfeti() {
        if (typeof confetti !== "function") {
          return;
        }
        confetti({
          particleCount: 80,
          spread: 70,
          origin: { y: 0.6 },
          colors: ["#6366f1", "#38bdf8", "#f472b6", "#22c55e"],
        });
      }

      function seleccionarPregunta(categoria, preguntasActivas) {
        const esEspecial = Math.random() < estado.configuracion.probabilidadEspecial;
        estado.preguntaEspecial = esEspecial;
        if (esEspecial) {
          estado.tiempoLimite = estado.configuracion.tiempoEspecial;
          estado.tiempoRestante = estado.configuracion.tiempoEspecial;
          return obtenerPreguntaEspecial();
        }
        estado.tiempoLimite = estado.configuracion.tiempoPregunta;
        estado.tiempoRestante = estado.configuracion.tiempoPregunta;
        const indiceReal = estado.ordenPreguntas[estado.indicePreguntaActual];
        return preguntasActivas[indiceReal];
      }

      function obtenerPreguntaEspecial() {
        const especiales = [
          {
            enunciado: "¿Qué teoría sugiere que la Atlántida pudo estar cerca del Mediterráneo?",
            opciones: ["Hipótesis mediterránea", "Teoría lunar", "Teoría polar", "Hipótesis marciana"],
            respuesta: "Hipótesis mediterránea",
            retroalimentacion: "Algunas teorías ubican la Atlántida cerca de Creta.",
          },
          {
            enunciado: "¿Cómo se llamó el supuesto continente perdido en el Océano Índico?",
            opciones: ["Lemuria", "Pangea", "Gondwana", "Hiperbórea"],
            respuesta: "Lemuria",
            retroalimentacion: "Lemuria fue una hipótesis del siglo XIX.",
          },
          {
            enunciado: "¿Qué idea sostiene que la historia tiene ciclos repetidos?",
            opciones: ["Teoría cíclica", "Teoría lineal", "Teoría del progreso", "Teoría del caos"],
            respuesta: "Teoría cíclica",
            retroalimentacion: "La teoría cíclica habla de repeticiones históricas.",
          },
          {
            enunciado: "¿Qué ciudad perdida se asocia con un mito de oro en Sudamérica?",
            opciones: ["El Dorado", "Troya", "Pompeya", "Mohenjo-Daro"],
            respuesta: "El Dorado",
            retroalimentacion: "El Dorado es un mito de riqueza legendaria.",
          },
          {
            enunciado: "¿Qué enigma histórico rodea a la Biblioteca de Alejandría?",
            opciones: ["Su destrucción", "Su fundación", "Su traslado", "Su reconstrucción"],
            respuesta: "Su destrucción",
            retroalimentacion: "Se debate cómo y cuándo fue destruida.",
          },
        ];
        return especiales[Math.floor(Math.random() * especiales.length)];
      }

      // Temporizador de la pregunta actual.
      function iniciarTemporizador() {
        detenerTemporizador();
        etiquetaTiempo.textContent = estado.tiempoRestante;
        temporizador = setInterval(() => {
          estado.tiempoRestante -= 1;
          etiquetaTiempo.textContent = estado.tiempoRestante;
          if (estado.tiempoRestante <= 0) {
            detenerTemporizador();
            perderPregunta("Se acabó el tiempo.");
          }
        }, 1000);
      }

      function detenerTemporizador() {
        if (temporizador) {
          clearInterval(temporizador);
          temporizador = null;
        }
      }

      // Temporizador visual del comodín de investigar.
      function iniciarTemporizadorInvestigacion() {
        tiempoInvestigacionRestante = 10;
        if (temporizadorInvestigar) {
          clearInterval(temporizadorInvestigar);
        }
        desactivarBloqueoSeguridadTemporal();
        estadoGuardado.textContent = "Seguridad desbloqueada por 10s.";
        actualizarComodines();
        temporizadorInvestigar = setInterval(() => {
          tiempoInvestigacionRestante -= 1;
          actualizarComodines();
          if (tiempoInvestigacionRestante <= 0) {
            detenerTemporizadorInvestigacion();
          }
        }, 1000);
      }

      function detenerTemporizadorInvestigacion() {
        if (temporizadorInvestigar) {
          clearInterval(temporizadorInvestigar);
          temporizadorInvestigar = null;
        }
        tiempoInvestigacionRestante = 0;
        restaurarBloqueoSeguridad();
        actualizarComodines();
      }

      function perderPartida(mensaje) {
        estado.partidaIniciada = false;
        textoPregunta.textContent = "Partida perdida.";
        contenedorOpciones.innerHTML = "";
        textoFeedback.textContent = `${mensaje} Debes empezar de cero.`;
        estado.indicePreguntaActual = 0;
        estado.puntaje = 0;
        estado.vidas = estado.configuracion.vidasIniciales;
        estado.ordenPreguntas = obtenerOrdenAleatorio(
          obtenerTotalPreguntas(estado.categorias[estado.indiceCategoriaActual])
        );
        estado.comodines = { ...estado.configuracion.comodines };
        detenerTemporizador();
        detenerTemporizadorInvestigacion();
        actualizarEstado();
        actualizarComodines();
        resetearTemaMenuInicio();
        guardarPartida();
      }

      function perderPregunta(mensaje) {
        textoFeedback.textContent = `${mensaje} Pierdes la pregunta.`;
        estado.respuestasIncorrectas += 1;
        if (estado.configuracion.vidasIniciales > 0) {
          estado.vidas = Math.max(0, estado.vidas - 1);
        }
        estado.indicePreguntaActual += 1;
        if (estado.dificultad === "hardcore") {
          perderPartida("Modo hardcore: perdiste la pregunta.");
          return;
        }
        if (estado.vidas <= 0 && estado.configuracion.vidasIniciales > 0) {
          perderPartida("Perdiste todas las vidas.");
          return;
        }
        actualizarEstado();
        actualizarPregunta();
      }

      // Ajusta texto/estado de botones de comodines.
      function actualizarComodines() {
        if (panelComodines) {
          panelComodines.classList.toggle("hidden", !estado.partidaIniciada);
        }
        const bloqueado = !estado.partidaIniciada;
        botonPista.disabled = bloqueado || estado.comodines.pista <= 0;
        botonSaltar.disabled = bloqueado || estado.comodines.saltar <= 0;
        botonInvestigar.disabled = bloqueado || estado.comodines.investigar <= 0;
        botonEliminar.disabled = bloqueado || estado.comodines.eliminar <= 0;
        botonPista.textContent = `Comodín: Pista (${estado.comodines.pista})`;
        botonSaltar.textContent = `Comodín: Saltar (${estado.comodines.saltar})`;
        const etiquetaInvestigar = tiempoInvestigacionRestante > 0 ? `${tiempoInvestigacionRestante}s` : "10s";
        botonInvestigar.textContent = `Comodín: Investigar ${etiquetaInvestigar} (${estado.comodines.investigar})`;
        botonEliminar.textContent = `Comodín: Eliminar 2 (${estado.comodines.eliminar})`;
      }

      function usarComodinPista() {
        if (!estado.partidaIniciada) {
          return;
        }
        if (!estado.comodines.pista) {
          return;
        }
        const categoria = estado.categorias[estado.indiceCategoriaActual];
        const respuesta = estado.preguntaActual?.respuesta ?? "";
        const pista = `Pista: piensa en la categoría ${categoria.nombre} y la respuesta inicia con \"${respuesta[0]}\".`;
        textoFeedback.textContent = pista;
        estado.comodines.pista -= 1;
        actualizarComodines();
        guardarPartida();
      }

      function usarComodinSaltar() {
        if (!estado.partidaIniciada) {
          return;
        }
        if (!estado.comodines.saltar) {
          return;
        }
        estado.comodines.saltar -= 1;
        estado.indicePreguntaActual += 1;
        actualizarComodines();
        actualizarPregunta();
        guardarPartida();
      }

      // Permite salir temporalmente de la pestaña sin penalización.
      function usarComodinInvestigar() {
        if (!estado.partidaIniciada) {
          return;
        }
        if (!estado.comodines.investigar) {
          return;
        }
        estado.comodines.investigar -= 1;
        estado.permitirSalidaHasta = Date.now() + 10000;
        iniciarTemporizadorInvestigacion();
        actualizarComodines();
        estadoGuardado.textContent = "Puedes salir 10 segundos para investigar.";
        guardarPartida();
      }

      function usarComodinEliminar() {
        if (!estado.partidaIniciada) {
          return;
        }
        if (!estado.comodines.eliminar || !estado.preguntaActual) {
          return;
        }
        const botones = Array.from(contenedorOpciones.querySelectorAll("button"));
        const incorrectos = botones.filter((boton) => boton.textContent !== estado.preguntaActual.respuesta);
        const disponibles = incorrectos.filter((boton) => !boton.classList.contains("opcion-descartada"));
        if (disponibles.length < 2) {
          return;
        }
        const seleccionados = disponibles.sort(() => 0.5 - Math.random()).slice(0, 2);
        seleccionados.forEach((boton) => {
          boton.disabled = true;
          boton.classList.add("opcion-descartada");
        });
        estado.comodines.eliminar -= 1;
        actualizarComodines();
        guardarPartida();
      }

      function gestionarSalidaVentana() {
        if (document.hidden) {
          if (!estado.configuracion.antiTrampa) {
            return;
          }
          if (Date.now() > estado.permitirSalidaHasta) {
            perderPregunta("Saliste de la pestaña sin comodín.");
          } else {
            setTimeout(() => {
              if (document.hidden && Date.now() > estado.permitirSalidaHasta) {
                perderPregunta("No regresaste a tiempo.");
              }
            }, 11000);
          }
        }
      }

      function enlazarMenu() {
        document.querySelectorAll("[data-action]").forEach((boton) => {
          boton.addEventListener("click", () => {
            const accion = boton.dataset.action;
            if (accion === "terminar") {
              volverAlMenuInicio("Partida terminada. Puedes iniciar otra desde el menú.");
            }
            if (accion === "guardar") {
              guardarPartida();
            }
            if (accion === "puntajes") {
              estadoGuardado.textContent = `Puntaje actual: ${estado.puntaje}`;
            }
          });
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        contenedorCategorias = document.getElementById("categorias");
        etiquetaCategoria = document.getElementById("etiquetaCategoria");
        etiquetaNivel = document.getElementById("etiquetaNivel");
        etiquetaVidas = document.getElementById("vidas");
        etiquetaPuntaje = document.getElementById("puntaje");
        textoPregunta = document.getElementById("textoPregunta");
        contenedorOpciones = document.getElementById("opciones");
        textoFeedback = document.getElementById("textoFeedback");
        estadoGuardado = document.getElementById("estadoGuardado");
        entradaNombre = document.getElementById("nombreGuardado");
        listaGuardados = document.getElementById("listaGuardados");
        etiquetaTiempo = document.getElementById("tiempoRestante");
        botonPista = document.getElementById("comodinPista");
        botonSaltar = document.getElementById("comodinSaltar");
        botonInvestigar = document.getElementById("comodinInvestigar");
        botonEliminar = document.getElementById("comodinEliminar");
        selectorDificultad = document.getElementById("selectorDificultad");
        textoDificultad = document.getElementById("textoDificultad");
        burbujaDificultad = document.getElementById("burbujaDificultad");
        rellenoDificultad = document.getElementById("rellenoDificultad");
        overlayInicio = document.getElementById("overlayInicio");
        overlayNuevaPartida = document.getElementById("overlayNuevaPartida");
        overlayGestorPartidas = document.getElementById("overlayGestorPartidas");
        inicioNombrePartida = document.getElementById("inicioNombrePartida");
        inicioCategoria = document.getElementById("inicioCategoria");
        inicioDificultad = document.getElementById("inicioDificultad");
        inicioDificultadNombre = document.getElementById("inicioDificultadNombre");
        inicioDificultadFill = document.getElementById("inicioDificultadFill");
        inicioDificultadResumen = document.getElementById("inicioDificultadResumen");
        listaGuardadosGestor = document.getElementById("listaGuardadosGestor");
        botonTerminarPartida = document.getElementById("botonTerminarPartida");
        panelComodines = document.getElementById("panelComodines");

        renderizarCategorias();
        inicioCategoria.innerHTML = estado.categorias
          .map((categoria, indice) => `<option value="${indice}">${categoria.nombre}</option>`)
          .join("");
        enlazarMenu();
        estado.ordenPreguntas = obtenerOrdenAleatorio(obtenerTotalPreguntas(estado.categorias[0]));
        aplicarDificultad("normal");
        actualizarJuego();
        renderizarGuardados();
        actualizarComodines();

        if (window.gsap) {
          gsap.from(".animar-entrada", {
            y: 20,
            opacity: 0,
            duration: 0.8,
            stagger: 0.12,
            ease: "power2.out",
          });
        }

        botonPista.addEventListener("click", usarComodinPista);
        botonSaltar.addEventListener("click", usarComodinSaltar);
        botonInvestigar.addEventListener("click", usarComodinInvestigar);
        botonEliminar.addEventListener("click", usarComodinEliminar);
        document.addEventListener("visibilitychange", gestionarSalidaVentana);

        document.getElementById("botonAbrirNuevaPartida").addEventListener("click", () => mostrarSoloOverlay(overlayNuevaPartida));
        document.getElementById("botonVolverInicio").addEventListener("click", () => mostrarSoloOverlay(overlayInicio));
        document.getElementById("botonAbrirGestor").addEventListener("click", abrirGestorPartidas);
        document.getElementById("botonCerrarGestor").addEventListener("click", () => mostrarSoloOverlay(overlayInicio));
        document.getElementById("botonIniciarPartida").addEventListener("click", iniciarPartidaDesdeMenu);
        inicioDificultad.addEventListener("input", actualizarSelectorInicioDificultad);
        actualizarSelectorInicioDificultad();

        ["contextmenu", "copy", "cut", "paste", "selectstart"].forEach((evento) => {
          document.addEventListener(evento, bloquearEventosSeguridad);
        });
        document.addEventListener("keydown", (evento) => {
          if (!seguridadDesbloqueada && (evento.ctrlKey || evento.metaKey) && ["c", "x", "v", "a"].includes(evento.key.toLowerCase())) {
            evento.preventDefault();
          }
        });
        activarBloqueoSeguridad();
        mostrarSoloOverlay(overlayInicio);
      });
    </script>
  </body>
</html>
